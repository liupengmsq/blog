-- MySQL dump 10.13  Distrib 5.5.49, for debian-linux-gnu (x86_64)
--
-- Host: localhost    Database: myblog
-- ------------------------------------------------------
-- Server version	5.5.49-0+deb7u1

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Current Database: `myblog`
--

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `myblog` /*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci */;

USE `myblog`;

--
-- Table structure for table `blog`
--

DROP TABLE IF EXISTS `blog`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `blog` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `summary` text COLLATE utf8_unicode_ci NOT NULL,
  `content` text COLLATE utf8_unicode_ci NOT NULL,
  `update_time` datetime NOT NULL,
  `create_time` datetime NOT NULL,
  `status` varchar(45) COLLATE utf8_unicode_ci NOT NULL,
  `show_count` int(11) NOT NULL DEFAULT '0',
  `user_name` varchar(45) COLLATE utf8_unicode_ci NOT NULL,
  `category_id` int(11) NOT NULL,
  `format` varchar(10) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_blog_1_idx` (`user_name`),
  KEY `fk_blog_2_idx` (`category_id`),
  CONSTRAINT `fk_blog_2` FOREIGN KEY (`category_id`) REFERENCES `category` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_username` FOREIGN KEY (`user_name`) REFERENCES `user` (`name`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=48 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `blog`
--

LOCK TABLES `blog` WRITE;
/*!40000 ALTER TABLE `blog` DISABLE KEYS */;
INSERT INTO `blog` VALUES (20,'使用Jenkins远程部署war包到tomcat container','使用Jenkins远程部署war包到tomcat container','<p>Jenkins首先使用maven将源代码进行编译打包，之后需要将war包传送到tomcat服务器上进行部署。</p>\r\n<p>来看一下Jenkins的基本配置，首先需要安装插件\"Deploy to container Plugin\":</p>\r\n<p>\r\n<a href=\"/resources/417769-20160608155015824-1832501015.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608155015824-1832501015.png\" width=\"705\" height=\"274\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>但是在安装插件时，Jenkins会先ping www.google.com这个域名来保证网络连通性 ，我们需要将其改为www.baidu.com，来使得检查阶段通过：</p>\r\n<p>编辑Jenkins的配置文件default.json:</p>\r\n<p>\r\n<a href=\"/resources/417769-20160608155322230-1902133793.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608155322230-1902133793.png\"  width=\"423\" height=\"33\" /></a><br/>\r\n</p>\r\n<p>将connnectionCheckUrl改为http://www.baidu.com/</p>\r\n<p>\r\n<a href=\"/resources/417769-20160608155334558-1428213072.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608155334558-1428213072.png\" width=\"1473\" height=\"432\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>还需要安装github相关插件，使其可以从github上pull代码下来：</p>\r\n<p>\r\n<a href=\"/resources/417769-20160608160530527-1277918565.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608160530527-1277918565.png\" width=\"873\" height=\"255\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>配置Jenkins的github：</p>\r\n<p>\r\n<a href=\"/resources/417769-20160608161305886-12288945.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608161305886-12288945.png\" width=\"930\" height=\"641\" /></a><br/>\r\n</p>\r\n<p>\r\n<a href=\"/resources/417769-20160608161510949-1669310641.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608161510949-1669310641.png\" width=\"920\" height=\"582\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>maven构建的参数和构建成功后需要做的操作如下：</p>\r\n<p>\r\n<a href=\"/resources/417769-20160608161709761-57172803.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608161709761-57172803.png\"  width=\"911\" height=\"618\" /></a><br/>\r\n</p>\r\n<p>上面的Context path是部署到tomcat的webapps下的目录名字，这里会将war包部署到tomcat的webapps/myblog.war</p>\r\n<p> </p>\r\n<p> </p>\r\n<p>\r\n<a href=\"/resources/417769-20160608161817980-1090995013.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608161817980-1090995013.png\"  width=\"873\" height=\"433\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>上面使用了插件\"deploy to container\"来将maven构建出来的war包部署到远程机器上面，使用tomcat的部署用户名tomcat。</p>\r\n<p> </p>\r\n<p>需要配置tomcat的配置文件tomcat/conf/tomcat-users.xml，将名为tomcat的用户配上以下三个角色：admin-gui, manager-gui和manager-script，这样才可以使用tomcat这个用户完成远程部署的功能：</p>\r\n<p>\r\n<a href=\"/resources/417769-20160608164022699-1073091087.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608164022699-1073091087.png\" width=\"896\" height=\"99\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>最后点击“立即构建”，成功后如下图：</p>\r\n<p>\r\n<a href=\"/resources/417769-20160608165404855-1564686491.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160608165404855-1564686491.png\"width=\"845\" height=\"408\" /></a><br/>\r\n</p>\r\n<p> </p>','2016-06-21 06:00:45','2016-06-18 08:25:47','PUBLISHED',16,'peng',5,'HTML'),(21,'使用JMeter测试基于WebSocket协议的服务','使用JMeter测试基于WebSocket协议的服务','<ul>\r\n	<li>由于JMeter没有针对WebSocket的sampler，所以就需要安装开源的插件，以使其支持WebSocket协议。</li>\r\n</ul>\r\n<h3 id=\"安装jmeter-websocketsampler\"><a name=\"安装jmeter-websocketsampler\" href=\"#安装jmeter-websocketsampler\"></a>安装JMeter WebSocketSampler</h3>\r\n<ul>\r\n	<li>\r\n		<p>首先，从github上clone源码下来，地址如下： <a href=\"https://github.com/maciejzaleski/JMeter-WebSocketSampler\">https://github.com/maciejzaleski/JMeter-WebSocketSampler</a></p>\r\n	</li>\r\n	<li>\r\n		<p>之后，使用Maven构建此代码后，将jar包“JMeterWebSocketSampler-1.0.2-SNAPSHOT.jar”放到JMeter的“lib/ext/”目录中，此目录是JMeter用来放置扩展包的地方。</p>\r\n	</li>\r\n	<li>\r\n		<p>最后，将websocket sampler依赖的其他jar包放到“lib”目录下，此目录是JMeter用来放插件所依赖的jar包的地方。websocket sampler所依赖的jar包如下：</p>\r\n		<ul>\r\n			<li>jetty-http-9.1.1.v20140108.jar</li>\r\n			<li>jetty-io-9.1.1.v20140108.jar</li>\r\n			<li>jetty-util-9.1.1.v20140108.jar</li>\r\n			<li>websocket-api-9.1.1.v20140108.jar</li>\r\n			<li>websocket-client-9.1.1.v20140108.jar</li>\r\n			<li>websocket-common-9.1.1.v20140108.jar</li>\r\n		</ul>\r\n	</li>\r\n	<li>\r\n		<p>打开JMeter，通过”Add” -> “Sampler” -> “WebSocket Sampler”，添加一个取样器：<br>\r\n<a href=\"/resources/417769-20160405151151484-1339355405.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160405151151484-1339355405.png\"  /></a>\r\n</p>\r\n\r\n\r\n\r\n\r\n\r\n\r\n	</li>\r\n\r\n\r\n\r\n\r\n\r\n</ul>\r\n<h3> </h3>\r\n<h3 id=\"创建一个简单的websocket实现：\"><a name=\"创建一个简单的websocket实现：\" href=\"#创建一个简单的websocket实现：\"></a>创建一个简单的websocket实现：</h3>\r\n<ul>\r\n	<li>通过下面blog所说的步骤，构建一个基于websocket协议的聊天室：<br><a href=\"http://waylau.com/netty-websocket-chat/\">http://waylau.com/netty-websocket-chat/</a></li>\r\n	<li>启动后如图：<br>\r\n<a href=\"/resources/417769-20160405151207187-91680215.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160405151207187-91680215.png\"  /></a>\r\n</li>\r\n\r\n\r\n\r\n\r\n\r\n</ul>\r\n<h3> </h3>\r\n<h3 id=\"使用jmeter测试websocket聊天室\"><a name=\"使用jmeter测试websocket聊天室\" href=\"#使用jmeter测试websocket聊天室\"></a>使用JMeter测试websocket聊天室</h3>\r\n<ul>\r\n	<li>\r\n		<p>配置WebSocket Sampler如下图：<br>\r\n<a href=\"/resources/417769-20160405151218125-2059241790.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160405151218125-2059241790.png\"  /></a>\r\n</p>\r\n\r\n\r\n\r\n\r\n\r\n\r\n	</li>\r\n	<li>\r\n		<p>运行后，查看JMeter显示结果：<br>\r\n<a href=\"/resources/417769-20160405151235906-492174240.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160405151235906-492174240.png\"  /></a>\r\n</p>\r\n\r\n\r\n\r\n\r\n\r\n\r\n	</li>\r\n	<li>\r\n		<p>查看聊天室，发现确实收到的此条消息：<br>\r\n<a href=\"/resources/417769-20160405151242156-1678150427.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160405151242156-1678150427.png\"  /></a>\r\n</p>\r\n	</li>\r\n</ul>\r\n','2016-06-20 15:43:14','2016-06-18 08:38:53','PUBLISHED',19,'peng',10,'HTML'),(22,'定制JMeter取样器','使用JMeter定义自己的取样器sampler，方法很简单，只需继承类org.apache.jmeter.protocol.java.sampler.AbstractJavaSamplerClient，并重写若干方法即可。','<div id=\"cnblogs_post_body\"><ul>\r\n<li>\r\n<p>JMeter运行你区定义自己的取样器sampler，方法很简单，只需继承类org.apache.jmeter.protocol.java.sampler.AbstractJavaSamplerClient，并重写若干方法即可。</p>\r\n</li>\r\n<li>\r\n<p>首先，创建一个maven项目，并加入jmeter相关的依赖包：</p>\r\n</li>\r\n</ul>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"></div>\r\n<pre class=\"brush: xml\">\r\n<dependencies>\r\n    <dependency>\r\n        <groupId>org.apache.jmeter</groupId>\r\n        <artifactId>ApacheJMeter</artifactId>\r\n        <version>2.10</version>\r\n    </dependency>\r\n    <dependency>\r\n        <groupId>org.apache.jmeter</groupId>\r\n        <artifactId>ApacheJMeter_core</artifactId>\r\n        <version>2.10</version>\r\n    </dependency>\r\n    <dependency>\r\n        <groupId>org.apache.jmeter</groupId>\r\n        <artifactId>ApacheJMeter_http</artifactId>\r\n        <version>2.10</version>\r\n    </dependency>\r\n    <dependency>\r\n        <groupId>org.apache.jmeter</groupId>\r\n        <artifactId>ApacheJMeter_java</artifactId>\r\n        <version>2.10</version>\r\n    </dependency>\r\n</dependencies>\r\n</pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"></span></div></div>\r\n<p> </p>\r\n<ul>\r\n<li>\r\n<p>然后，创建一个类，继承自AbstractJavaSamplerClient，并重写setupTest、teardownTest、runTest与getDefaultParameters方法即可</p>\r\n</li>\r\n</ul>\r\n<ul>\r\n<li>\r\n<p>代码示例如下：</p>\r\n</li>\r\n</ul>\r\n\r\n<pre class=\"brush: java\">\r\npackage pengliu.me.jmeter.plugins;\r\n\r\nimport org.apache.jmeter.config.Arguments;\r\nimport org.apache.jmeter.protocol.java.sampler.AbstractJavaSamplerClient;\r\nimport org.apache.jmeter.protocol.java.sampler.JavaSamplerContext;\r\nimport org.apache.jmeter.samplers.SampleResult;\r\nimport org.apache.jorphan.logging.LoggingManager;\r\nimport org.apache.log.Logger;\r\n\r\nimport java.util.Iterator;\r\nimport java.util.Random;\r\n\r\npublic class MySampler extends AbstractJavaSamplerClient\r\n{\r\n    private static final Logger log = LoggingManager.getLoggerForClass();\r\n\r\n    @Override\r\n    public void setupTest(JavaSamplerContext context)\r\n    {\r\n        Iterator<String> it = context.getParameterNamesIterator();\r\n        while (it.hasNext())\r\n        {\r\n            String paramName =  it.next();\r\n            this.log.info(String.format(\"-----------------paramName: %s, paramValue: %s-----------------\",\r\n                    paramName,\r\n                    context.getParameter(paramName)));\r\n        }\r\n\r\n        this.log.info(String.format(\"-----------------Get param \'name\' from JMeter: %s-----------------\",\r\n                context.getParameter(\"name\", \"Default Name\")));\r\n        this.log.info(String.format(\"-----------------Current Thread Id: %s, Start \'setupTest(JavaSamplerContext context)\'--------------------\",\r\n                Thread.currentThread().getId()));\r\n    }\r\n\r\n    @Override\r\n    public void teardownTest(JavaSamplerContext context)\r\n    {\r\n        this.log.info(String.format(\"-----------------Current Thread Id: %s, Start \'teardownTest(JavaSamplerContext context)\'--------------------\",\r\n                Thread.currentThread().getId()));\r\n    }\r\n\r\n    public SampleResult runTest(JavaSamplerContext javaSamplerContext)\r\n    {\r\n        SampleResult result = new SampleResult();\r\n        result.sampleStart();\r\n        try\r\n        {\r\n            Random r = new Random();\r\n            long sleepTime = (long)r.nextInt(5000);\r\n            this.log.info(String.format(\"-----------------Current Thread Id: %s, Running Test, sleep time is %s--------------------\",\r\n                    Thread.currentThread().getId(),\r\n                    sleepTime));\r\n            Thread.sleep(sleepTime);\r\n\r\n            if(sleepTime%2 == 0)\r\n            {\r\n                throw new Exception(\"--------This is my exception from runTest!!!---------\");\r\n            }\r\n\r\n            result.sampleEnd();\r\n            result.setSuccessful(true);\r\n            result.setSampleLabel(\"My Lable: SUCCESS: \" + Thread.currentThread().getId());\r\n        }\r\n        catch (Throwable e)\r\n        {\r\n            result.sampleEnd();\r\n            result.setSuccessful(false);\r\n            result.setSampleLabel(\"My Lable: FAIL: \" + Thread.currentThread().getId());\r\n\r\n            e.printStackTrace();\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    @Override\r\n    public Arguments getDefaultParameters() {\r\n\r\n        Arguments params = new Arguments();\r\n\r\n        params.addArgument(\"name\", \"edw\");\r\n\r\n        return params;\r\n    }\r\n}\r\n\r\n</pre>\r\n\r\n<ul>\r\n<li>其中setupTest与teardownTest方法，在一个线程只被执行一次，无论此Thread Group配置的Loop Count是多少，每个线程只运行一次这两个方法。</li>\r\n</ul>\r\n<ul>\r\n<li>其中runTest方法，如果一个线程配置了多次的Loop Count，那么此runTest就会运行多次</li>\r\n</ul>\r\n<ul>\r\n<li> 其中getDefaultParameters方法，返回的是JMeter界面的参数列表，如下图： <br>\r\n<a href=\"/resources/417769-20160401180756879-270848606.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160401180756879-270848606.png\" height=\"30%\"  /></a>\r\n</li>\r\n</ul>\r\n<ul>\r\n<li>使用”mvn package”命令打包上面的sampler:</li>\r\n</ul>\r\n<p style=\"margin-left: 30px;\">\r\n<a href=\"/resources/417769-20160401180814348-1176040405.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160401180814348-1176040405.png\"  /></a>\r\n</p>\r\n<p> </p>\r\n<ul>\r\n<li>将打包好的jar包放到JMeter的lib/ext目录下：\r\n   </li>\r\n</ul>\r\n<p style=\"margin-left: 30px;\">\r\n<a href=\"/resources/417769-20160401180824957-1457881516.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160401180824957-1457881516.png\" height=\"30%\"   /></a>\r\n</p>\r\n<p style=\"margin-left: 30px;\"> </p>\r\n<ul>\r\n<li><span style=\"line-height: 1.5;\">启动JMeter, 并加入一个Java Request的sampler: </span></li>\r\n</ul>\r\n<p style=\"margin-left: 30px;\">\r\n<a href=\"/resources/417769-20160401180849738-2129685299.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160401180849738-2129685299.png\" height=\"30%\"  /></a>\r\n</p>\r\n<p style=\"margin-left: 30px;\"> </p>\r\n<ul>\r\n<li><span style=\"line-height: 1.5;\">Classname选择代码中自定义的sampler类： </span>\r\n<a href=\"/resources/417769-20160401180906551-249494530.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160401180906551-249494530.png\"  /></a>\r\n</li>\r\n</ul>\r\n<p> </p>\r\n<ul>\r\n<li>配置Thread Group，线程数为２，循环数为５： </li>\r\n</ul>\r\n<p style=\"margin-left: 30px;\">\r\n<a href=\"/resources/417769-20160401180920707-1649655577.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160401180920707-1649655577.png\"  /></a>\r\n</p>\r\n<ul>\r\n<li>\r\n<p>选中Java Request这个sampler，可以设置参数name的值</p>\r\n</li>\r\n</ul>\r\n<ul>\r\n<li>\r\n    开始执行后，JMeter会产生两个线程，每个线程都跑只跑一遍setupTest与teardownTest方法，但会跑５遍runTest方法</li>\r\n</ul>\r\n<ul>\r\n<li>\r\n     查看JMeter的日志输出：\r\n     </li>\r\n</ul>\r\n<p style=\"margin-left: 30px;\">\r\n<a href=\"/resources/417769-20160401180931894-624793592.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160401180931894-624793592.png\" height=\"50%\"  /></a>\r\n</p>\r\n<p> </p>\r\n<ul>\r\n<li>\r\n<p>查看”View Results in Table”中的结果：\r\n     <br>\r\n<a href=\"/resources/417769-20160401180939519-208110028.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/417769-20160401180939519-208110028.png\" height=\"30%\"   /></a>\r\n</p>\r\n</li>\r\n</ul>\r\n<p> </p></div>','2016-06-21 07:27:00','2016-06-18 08:54:36','PUBLISHED',33,'peng',10,'HTML'),(25,'解析Visual Studio Unit Test Result文件(trx文件)','解析Visual Studio Unit Test Result文件(trx文件)','<div id=\"cnblogs_post_body\"><p>Visual Studio单元测试的结果可以在Test Results窗口中很容易的看到，也可以使用TFS Publish测试结果:</p>\r\n<p>\r\n<a href=\"/resources/151518552518976.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151518552518976.png\"  /></a><br>\r\n</p>\r\n<p>但是如果想要脱离IDE(使用mstest.exe来运行test dll或test list文件)来解析测试结果文件，就要面对这个trx文件复杂的结构了：</p>\r\n<p>\r\n<a href=\"/resources/151519121882835.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151519121882835.png\"  /></a>\r\n</p>\r\n<p>每当运行完单元测试后，IDE会产生TestResults文件夹(此文件夹和test list文件*.vsmdi在同一层)来保存trx文件：</p>\r\n<p>\r\n<a href=\"/resources/151519359854231.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151519359854231.png\"  /></a>\r\n</p>\r\n<p>我也曾写过解析这个文件的代码，并生成html格式的报告并通过邮件发出。最近发现一个开源的工具能够生成很易读的html格式的test report，地址如下：</p>\r\n<p><a href=\"http://trx2html.codeplex.com/\">http://trx2html.codeplex.com/</a></p>\r\n<p>下载，解压后，直接在命令行下运行这个trx2html.exe，并传入trx测试结果文件就行了：</p>\r\n<p>\r\n<a href=\"/resources/151519577826972.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151519577826972.png\"  /></a>\r\n</p>\r\n<p>执行完毕，会在同级目录下生成.html文件格式的test report:</p>\r\n<p>\r\n<a href=\"/resources/151520497828019.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151520497828019.png\"  /></a>\r\n</p>\r\n<p>和我们的测试代码对比一下：</p>\r\n<p>\r\n<a href=\"/resources/151521137829887.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151521137829887.png\"  /></a>\r\n</p>\r\n<p>可以看到Description的内容和错误信息会显示在报告中</p></div>','2016-06-20 15:15:19','2016-06-19 14:14:11','PUBLISHED',30,'peng',6,'HTML'),(28,'使用XSLT生成Nunit测试报告','最近从mstest转到nunit，原因很简单，mstest如果要脱离IDE单独安装很麻烦，PPE环境下只会安装必要的依赖包，不可能把IDE也装上。相比之下，Nuit就清凉很多了，安装后可以直接用nuit-console.exe来运行测试了。','<div id=\"cnblogs_post_body\"><p><span>最近从mstest转到nunit，原因很简单，mstest如果要脱离IDE单独安装很麻烦，PPE环境下只会安装必要的依赖包，不可能把IDE也装上。相比之下，Nuit就清凉很多了，安装后可以直接用nuit-console.exe来运行测试了。</span><br><br><span>但问题是测试结果是xml形式的，可读性一般，如下：</span></p>\r\n<pre class=\"brush: xml\">\r\n<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"no\"?>\r\n<?xml-stylesheet type=\"text/xsl\" href=\"nunitresult.xslt\"?>\r\n \r\n<!--This file represents the results of running a test suite-->\r\n<test-results name=\"E:\\NUnitTest.dll\" total=\"3\" errors=\"1\" failures=\"0\" not-run=\"0\" inconclusive=\"0\" ignored=\"0\" skipped=\"0\" invalid=\"0\" date=\"2012-07-04\" time=\"10:09:16\">\r\n  <environment nunit-version=\"2.6.0.12051\" clr-version=\"2.0.50727.5456\" os-version=\"Microsoft Windows NT 6.1.7601 Service Pack 1\" platform=\"Win32NT\" cwd=\"C:\\Program Files\\NUnit 2.6\\bin\" machine-name=\"Test\" user=\"Tester\" user-domain=\"Test\" />\r\n  <culture-info current-culture=\"en-US\" current-uiculture=\"en-US\" />\r\n  <test-suite type=\"Assembly\" name=\"E:\\NUnitTest.dll\" executed=\"True\" result=\"Failure\" success=\"False\" time=\"0.109\" asserts=\"0\">\r\n    <results>\r\n      <test-suite type=\"Namespace\" name=\"NUnitTest\" executed=\"True\" result=\"Failure\" success=\"False\" time=\"0.103\" asserts=\"0\">\r\n        <results>\r\n          <test-suite type=\"TestFixture\" name=\"Class1\" executed=\"True\" result=\"Failure\" success=\"False\" time=\"0.102\" asserts=\"0\">\r\n            <results>\r\n              <test-case name=\"NUnitTest.Class1.SampleTest1\" description=\"Description1\" executed=\"True\" result=\"Success\" success=\"False\" time=\"0.061\" asserts=\"0\">\r\n                <failure>\r\n                  <message><![CDATA[Error message from assert fail!!]]></message>\r\n                  <stack-trace><![CDATA[at NUnitTest.Class1.SampleTest1() in E:\\NUnitTest\\Class1.cs:line 16\r\n]]></stack-trace>\r\n                </failure>\r\n              </test-case>\r\n              <test-case name=\"NUnitTest.Class1.SampleTest2\" description=\"Description2\" executed=\"True\" result=\"Error\" success=\"False\" time=\"0.002\" asserts=\"0\">\r\n                <failure>\r\n                  <message><![CDATA[System.Exception : Throwing an new exception!!]]></message>\r\n                  <stack-trace><![CDATA[at NUnitTest.Class1.SampleTest2() in E:\\NUnitTest\\Class1.cs:line 23\r\n]]></stack-trace>\r\n                </failure>\r\n              </test-case>\r\n              <test-case name=\"NUnitTest.Class1.SampleTest3\" description=\"Description3\" executed=\"True\" result=\"Success\" success=\"True\" time=\"0.000\" asserts=\"0\" />\r\n              <test-case name=\"NUnitTest.Class1.SampleTest4\" description=\"Description4\" executed=\"True\" result=\"Success\" success=\"True\" time=\"0.000\" asserts=\"0\" />\r\n            </results>\r\n          </test-suite>\r\n        </results>\r\n      </test-suite>\r\n    </results>\r\n  </test-suite>\r\n</test-results>\r\n</pre>\r\n\r\n<p><span><span>于是按照解析mstest测试结果的工具trx2html所生成的html报告的样子，自己写了下面的xslt来解析：</span></span></p>\r\n\r\n<pre class=\"brush: xml\">\r\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\r\n    <xsl:template match=\"/\">\r\n    <html>\r\n        <head>\r\n            <title>@@Title@@</title>\r\n            <style type=\'text/css\'>\r\n                body, td, th {font:Verdana;vertical-align:top;text-align:left}\r\n                body {margin:0px 0px 0px 15px}\r\n                hr {margin:0px 0px 0px -15px;border:solid 1pt #dcdcdc}\r\n                table {border-collapse:collapse;border:solid 1px #a9a9a9}\r\n                th {background-color:#dcdcdc;border:solid 1px #a9a9a9;text-indent:2pt;font-weight:bolder}\r\n                td {border:solid 1px #a9a9a9}\r\n \r\n                span.ok{background-color:lime;color:black;font-size:40%;color:lime;display:inline-block;}\r\n                span.ko{background-color:red;color:white;font-size:40%;color:red;display:inline-block;}\r\n                span.ignore{background-color:yellow;color:white;font-size:40%;color:yellow;display:inline-block;}\r\n \r\n                p.testKo{\r\n                cursor:hand;\r\n                width:40px;\r\n                height:40px;\r\n                background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAUCAIAAAAGHlpnAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAPBSURBVDhPY/hPMWDANOHXu1fvTx94v3bmy3kdT6bXP51c9XRi5ctpzS8O7vz57jWmehQj/v398+XKqXfLJ79Z0P5pUce3Re2/5jX9nFn9pb/odUv6w/Koh03Zb88dRzMF2Yh/3y4ce7uw89Pizt+r+v8s7fw1t/7ntIqfEwt/duX8akn5Vhf1MM/3WrrPkz2bkE1BGPH1xvk381q/LO36vbLv18LmX9PKf/bl/ehM/9mc+KM+5nt1+LfywM8FXg8SbM9E2rw8ewxuCtSIv5/ev10+6cOC1t/Lu/+c3g2R/jmz9kdVyM9JxVDuxrmfMhzeJ5pfCNI7kRP++/s3iDjUiK+n9r2eUftrcftvoOMn5P97dh8o9/fJne/VYX8f3QKxH978mGr7IcHiTbThoxDt7c5q97au+fv7N8KIN8snf5ha8WtO/Y9JRT9ak35OLYfY8O/NMxD59dOX8uAP8aZvow2eh2o98lfb7yh/tCTpz9fPCCOeTq7+Mrn0x6Tin51pP2ojvxX7/to0F+7b7ws63scav4vUfx2i+cRP5a6n/FF7qQ2hjj9fv0AYca8950d//o/uzB9Nsd/K/b/muX8tCYAb8SHd4W247psQjZf+yo885W65SJ2wEV3kbvTlznWEEbca0r61pX5vjv9WFfo13+NLluPvM/vhRvw8tuNNkPorP6VnXnL3nSWu2oscNheYY6/98co5hBF3GtLfV4Z/B+ov9P2a6fxz7XSI/u+b5kEYXxZ0vvSUfeQscdNO+Jwl/2YDnoVOel/ug0IaGiMP+2seZ7p/LwDa7/S1Kuzfl09AuR8b574N1vi+cwUoRD9/eBlnds9O+JIF/0lTngWanNsyI/58BimDGvH64PYLMTZvUm0/Jln+unISFIsvHr+NM33tr/Q6XPfPs4cgF505cNWC76Qx1y5djn413ht7d/77+xdhxO9PHy5Wpp4PNnoeafg8TPdZkOazANVnPgrPPGSfuog/chS9ayN4xZz7hBHHXj3W2Socy+P8/4ATBcIIIOvlhVOHwm1PeGnc9lW946V420P2tovkTQexG7aCVyx5z5lxHTPk2KPLMl+VdZql2sNLF+CBjZJTb2/fsMXLcIe93Dkn6YsOEudtRM5ZCZwx4z1mxHlQn22bFutMZdYpBtLnt26E60dxBUT0wZH922PcF5rJrDYU3mrIt8eQZ7sO1xoN9nmq7P1KnHOcDZ8f3YesH4sRoGB78+rKqkWbkoNmOehOsFTvtVSfYqm62Nvi9KS2T08foenHbgSmIvwiACPu1otCSuPAAAAAAElFTkSuQmCC);\r\n                background-repeat:no-repeat\r\n                }                \r\n                p.testOk{\r\n                cursor:hand;\r\n                width:40px;\r\n                height:40px;\r\n                background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMTSURBVDhPpdTrL5tRGABw/80+LCKzGHHJqEt19KWoy2sW0a5D0a6hVcWoKu26Tlt1p1Uzd6WoqdVtQ0vEZW6xi2UXsw3r0FKq3ZHKeGUfljgfTvKcnF+ec3nOcbBdoTlcwdou40+/PopHH5M74sk98TQNiTbwIFF5l/AspnRE+O33xqVMCDz+YZSiJNS9kejML7XW7o49heyLRPqWx5t9lNabAEl9VXMdF/05nlx/laFOntjVLNp0mpPOpu2qinWBcInDm83h6JlsPYMxmOwvdG+davzrz/DW/k+mmqI3audt471HLfWbUtEKt3g2m62n502ms8aoJCVM6U8gq+K9i1zefV+z+zPct9QlneMt2CbUx62yjVLhIrtAz8h9TWONpmWOpOLlgUINV7XaTu0hRlRj0ptTEZimSho6UA1alYrNspJlDkjIGqMwhlPp2mRcbUC+imk5sZgth6x+WqwiNLgEhcDUgfv9lrbmnRrRKjdjKDFrNI0xlJKhJUfUBWYr0/cP944sR5U6UVwjLlaB8+a7IDBdS+4yNoITki7zRSM8WAFlDqfg5RhmB/Xw+ABMrdZJIhvuwIoQWB7iK3BDYEofESy4eD57Zkt3bDlmd2ehSz0y2ykms8lqtVZPlUUqMEBG1WHxNUE+fFcEJrZHi1YKOdPMp9PcXbPBZDYWdLNMR0YwqUYvDZej4QYoqi4ovCowtDzAi+uMwLm9dLaOXqBjUDUEsY5nXypotfqyMHlAjAKKkmGBDCnzDxb7YAS3EXhwWU3qjM0Ze5g+kJigjJTNVHw1fC7S5obL0HA9FuSMOJV+kAQF7lmsESCwwWSIKscS26IpfYQkZVxcM47YAoOjjpaDTWJwlWhI6hcsQaGfeLrmOa5triIwCNQLKh/erbiGMFIbHP8cD8ux0TIsKAlcBRoq9Q0WowIEns7Z10pe8C+Xpz3WLKqhEn9QwJAUFVaBxlcHgR57mtDLvcDJJfe6RCP898Owj+7sb7dPN5Fk99zyHd3ZTh6FN0DvxblJries/3h/UZ7X9qXR/wyv9JP8AUelhZbR6oNqAAAAAElFTkSuQmCC);\r\n                background-repeat:no-repeat\r\n                }\r\n                p.testIgnore{\r\n                cursor:hand;\r\n                width:40px;\r\n                height:40px;\r\n                background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJeSURBVDhPY/hPAWDApfff328EjcWu+de3J49PWD47a3lym/Xlk0txmYJd89s7kz48UvnxLfDKEb4p1ZJ//vzGqh+L5r+/Pzw5ZfLvj+P//57//0tOreY+f2QWsZo/Pel9f8/h3//QRw9k//6TO7aTc26rGlGa//x8+vK83f+/BQsW+SnKa/d1G/z/zzetmvPCifWY+tGd/eH+1E/3ff//r01MtmFg8A3xsv7/X2j/GqbZLToENP/99fHJSZd/v5r+/8/sbjNkYkiY1a3+/z//15fcE8q47t44jqYfxeZPj2e/ueXz/3/v//+uuzbJKfA3Xjyi9P8Py9/v4ptnsM7rcsCp+d/fj8/Oevz6Vvz/f97//2pHDonqyMfdvSL4/wPDrw+ib66z9ZdyPn9yB1k/wubvr5a9ugb0IVCnw/+//FcvcCV46jy/yfb/GcPPR7x/Pois6GFeNTMSi+Z/fz68OOf+/bPX//9u/z9L/H/J+v8z07NznP/fMvy/w/DzCtOv95JPz3NOLOP9/u0DXD/U5q/PV7w6L/fvv+X/TzL/H7D/e8O8eBqLvy/7poXsQJt/nWP4eovn71vRpe2sy2fEomj+8Pb+9e0W3+9I//8s9f8W2/9bzN+fMViZMjIwxBWnJP5/wfDrLMP3c4x/ngg+Pcg0sd4eRfPrp2e3T+d/tIf7xWG2J7uZHu1gen6IcXk3U1WK2/k1Zo/3MN7Zwnh/K+OjXUwv9jGu6xdH0fz719cbh9Jn1LBPLmMDoklgcloVELFOqWCdVAZEIBEgmlrJuqBDE93PBLMuUWmbJFMAIcChwBwUNxQAAAAASUVORK5CYII=);\r\n                background-repeat:no-repeat\r\n                }\r\n                div.barContainer{width:100%;border:solid 1px black}\r\n                div.trace{font:100% Courier}\r\n                div.border{border:dotted 1px #dcdcdc;padding:2px 2px 2px 2px}\r\n                div.contents{border:dotted 1px #dcdcdc;padding:2px 2px 2px 2px;background-color:#efefef}\r\n            </style>\r\n        </head>\r\n        <body>\r\n            <a name=\'__top\' />\r\n            <h3>@@Title@@</h3>\r\n            <div class=\'contents\'>\r\n                Summary\r\n            </div>\r\n            <br />\r\n            <a name=\'totals\' />\r\n            <table id=\'tMainSummary\'  border=\'0\' width=\'900px\'>\r\n                <tr>\r\n                    <th>Percent</th>\r\n                    <th>Status</th>\r\n                    <th>TotalTests</th>\r\n                    <th>Errors</th>\r\n                    <th>Failures</th>\r\n                    <th>NotRun</th>\r\n                    <th>Inconclusive</th>\r\n                    <th>Ignored</th>\r\n                    <th>Skipped</th>\r\n                    <th>Invalid</th>\r\n                    <th>TimeTaken</th>\r\n                </tr>\r\n                <tr>\r\n                    <xsl:apply-templates />\r\n                </tr>\r\n            </table>\r\n            <br />\r\n            <br />\r\n            <div class=\'contents\'>\r\n                Detail\r\n            </div>\r\n            <br />\r\n            <table id=\"tSlowerMethods\" border=\'0\' width=\'900px\'>\r\n                <tr>\r\n                    <th>TestMethod</th>\r\n                    <th colspan=\'2\'>Status</th>\r\n                    <th>Duration</th>\r\n                </tr>\r\n                <xsl:for-each select=\"//test-case\">\r\n                    <tr>\r\n                        <td><xsl:value-of select=\"@name\"/></td>\r\n                        <td>\r\n                            <xsl:choose>\r\n                                <xsl:when test=\"@result = \'Success\'\">\r\n                                    <p class=\'testOk\'></p>\r\n                                </xsl:when>\r\n                                <xsl:otherwise>\r\n                                    <p class=\'testKo\'></p>\r\n                                </xsl:otherwise>\r\n                            </xsl:choose>\r\n                        </td>\r\n                        <td width=\'100%\'>\r\n                            <xsl:value-of select=\"@description\"/><br />\r\n                            <xsl:value-of select=\"failure/message\"/><br />\r\n                            <xsl:value-of select=\"failure/stack-trace\"/>\r\n                        </td>\r\n                        <td><xsl:value-of select=\"@time\"/></td>\r\n                    </tr>\r\n                </xsl:for-each>\r\n            </table>\r\n        </body>\r\n    </html>\r\n    </xsl:template>\r\n \r\n    <xsl:template match=\"test-results\">\r\n        <td>\r\n            <xsl:value-of \r\n                select=\"round(((number(@total)-number(@errors)-number(@failures)-number(@not-run)-number(@inconclusive)-number(@ignored)-number(@skipped)-number(@invalid)) div @total) * 100)\"/>%\r\n        </td>\r\n        <td width=\'350px\' style=\'vertical-align:middle;font-size:200%\'>\r\n            <div class=\"barContainer\">\r\n                <span class=\"ok\" title=\"Passed!\">\r\n                    <xsl:attribute name=\"style\">\r\n                        width:<xsl:value-of select=\"round(((number(@total)-number(@errors)-number(@failures)-number(@not-run)-number(@inconclusive)-number(@ignored)-number(@skipped)-number(@invalid)) div @total) * 100)\"/>%\r\n                </xsl:attribute>p</span>\r\n                <span class=\"ko\" title=\"Failed\">\r\n                    <xsl:attribute name=\"style\">\r\n                        width:<xsl:value-of select=\"100-round(((number(@total)-number(@errors)-number(@failures)-number(@not-run)-number(@inconclusive)-number(@ignored)-number(@skipped)-number(@invalid)) div @total) * 100)\"/>%\r\n                    </xsl:attribute>\r\n                    f</span>\r\n            </div>\r\n        </td>\r\n        <td><xsl:value-of select=\"@total\"/></td>\r\n        <td><xsl:value-of select=\"@errors\"/></td>\r\n        <td><xsl:value-of select=\"@failures\"/></td>\r\n        <td><xsl:value-of select=\"@not-run\"/></td>\r\n        <td><xsl:value-of select=\"@inconclusive\"/></td>\r\n        <td><xsl:value-of select=\"@ignored\"/></td>\r\n        <td><xsl:value-of select=\"@skipped\"/></td>\r\n        <td><xsl:value-of select=\"@invalid\"/></td>\r\n        <td><xsl:value-of select=\"@date\"/> <xsl:value-of select=\"@time\"/></td>\r\n    </xsl:template>\r\n    </xsl:stylesheet>\r\n\r\n</pre>\r\n\r\n<p><span>其中css样式是抄trx2html报告的，并做了一些改动。</span><br><br><span>这是解析后的样子：</span></p>\r\n<p>\r\n<a href=\"/resources/28-151508065481160.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/28-151508065481160.png\" /></a><br/>\r\n</p>\r\n<p><span><span>加了个@@Title@@可以在解析代码中替换为想要的标题。</span><br><br><span>好了，之后就写个工具解析和生成html report文件吧：</span></span></p>\r\n\r\n<pre class=\"brush: csharp\">\r\nusing System.IO;\r\nusing System.Xml;\r\nusing System.Xml.Xsl;\r\n \r\nnamespace NUnitHtmlTestResultParser\r\n{\r\n    class Program\r\n    {\r\n        static int Main(string[] args)\r\n        {\r\n            if (args.Length != 3)\r\n            {\r\n                Console.WriteLine(HelpInfo());\r\n                return 1;\r\n            }\r\n            if (!File.Exists(args[0]))\r\n            {\r\n                Console.WriteLine(\"Can not find result file \" + args[0]);\r\n                Console.WriteLine(HelpInfo());\r\n                return 2;\r\n            }\r\n            try\r\n            {\r\n                XmlDocument xDoc = new XmlDocument();\r\n                xDoc.Load(args[0]);\r\n                string returnhtml = ConvertXML(xDoc, @\"nunitresult.xslt\", new XsltArgumentList()).Replace(\"@@Title@@\", args[2]);\r\n                using (TextWriter tw = new StreamWriter(args[1]))\r\n                {\r\n                    tw.Write(returnhtml);\r\n                }\r\n                Console.WriteLine(\"Done!!\");\r\n            }\r\n            catch (Exception e)\r\n            {\r\n                Console.WriteLine(e.Message);\r\n                Console.WriteLine(HelpInfo());\r\n                return 1;\r\n            }\r\n            return 0;\r\n        }\r\n \r\n        private static string HelpInfo()\r\n        {\r\n            return \"Usage: NUnitHtmlTestResultParser.exe SOURCE DEST TITLE\" + System.Environment.NewLine +\r\n                \"SOURCE is nunit test result file\" + System.Environment.NewLine +\r\n                \"DEST is parsed html test result file\" + System.Environment.NewLine +\r\n                \"TITLE is test report title\" + System.Environment.NewLine;\r\n        }\r\n \r\n        private static string ConvertXML(XmlDocument InputXMLDocument, string XSLTFilePath\r\n, XsltArgumentList XSLTArgs)\r\n        {\r\n            using (StringWriter sw = new StringWriter())\r\n            {\r\n                XslCompiledTransform xslTrans = new XslCompiledTransform();\r\n                xslTrans.Load(XSLTFilePath);\r\n                xslTrans.Transform(InputXMLDocument.CreateNavigator(), XSLTArgs, sw);\r\n                return sw.ToString();\r\n            }\r\n        }\r\n    }\r\n}\r\n</pre>\r\n\r\n<p><span><span>好了，试试这个工具：</span><br><span>$ NUnitHtmlTestResultParser.exe result.xml result.html “Test result for abc”</span><br><span>$ Done!!</span></span></p>\r\n<p> </p>\r\n<p><span><span>打开result.html看看：</span><br>\r\n<a href=\"/resources/28-151509162982650.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/28-151509162982650.png\" /></a><br/>\r\n<br><span>由于我的测试结果是要通过邮件发出的，并且都是通过outlook收发邮件的，如果以上面这种html直接发到邮箱里面的话，展现的结果是这个鬼样子：</span><br>\r\n\r\n<a href=\"/resources/28-151510172204405.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/28-151510172204405.png\" /></a><br/>\r\n<br><span>好吧，继续修改之前的xslt，使其能在outlook中显示正常：</span></span></p>\r\n<p> </p>\r\n<p><span> </span></p>\r\n\r\n<pre class=\"brush: xml\">\r\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\r\n    <xsl:template match=\"/\">\r\n    <html>\r\n        <head>\r\n            <title>@@Title@@</title>\r\n            <style type=\'text/css\'>\r\n                body, td, th {font:Verdana;vertical-align:top;text-align:left}\r\n                body {margin:0px 0px 0px 15px}\r\n                hr {margin:0px 0px 0px -15px;border:solid 1pt #dcdcdc}\r\n                table {border-collapse:collapse;border:solid 1px #a9a9a9}\r\n                th {background-color:#dcdcdc;border:solid 1px #a9a9a9;text-indent:2pt;font-weight:bolder}\r\n                td {border:solid 1px #a9a9a9}\r\n \r\n                span.ok{background-color:lime;color:black;font-size:40%;color:lime;display:inline-block;}\r\n                span.ko{background-color:red;color:white;font-size:40%;color:red;display:inline-block;}\r\n                span.ignore{background-color:yellow;color:white;font-size:40%;color:yellow;display:inline-block;}\r\n \r\n                p.testKo{\r\n                cursor:hand;\r\n                width:40px;\r\n                height:40px;\r\n                background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAUCAIAAAAGHlpnAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAPBSURBVDhPY/hPMWDANOHXu1fvTx94v3bmy3kdT6bXP51c9XRi5ctpzS8O7vz57jWmehQj/v398+XKqXfLJ79Z0P5pUce3Re2/5jX9nFn9pb/odUv6w/Koh03Zb88dRzMF2Yh/3y4ce7uw89Pizt+r+v8s7fw1t/7ntIqfEwt/duX8akn5Vhf1MM/3WrrPkz2bkE1BGPH1xvk381q/LO36vbLv18LmX9PKf/bl/ehM/9mc+KM+5nt1+LfywM8FXg8SbM9E2rw8ewxuCtSIv5/ev10+6cOC1t/Lu/+c3g2R/jmz9kdVyM9JxVDuxrmfMhzeJ5pfCNI7kRP++/s3iDjUiK+n9r2eUftrcftvoOMn5P97dh8o9/fJne/VYX8f3QKxH978mGr7IcHiTbThoxDt7c5q97au+fv7N8KIN8snf5ha8WtO/Y9JRT9ak35OLYfY8O/NMxD59dOX8uAP8aZvow2eh2o98lfb7yh/tCTpz9fPCCOeTq7+Mrn0x6Tin51pP2ojvxX7/to0F+7b7ws63scav4vUfx2i+cRP5a6n/FF7qQ2hjj9fv0AYca8950d//o/uzB9Nsd/K/b/muX8tCYAb8SHd4W247psQjZf+yo885W65SJ2wEV3kbvTlznWEEbca0r61pX5vjv9WFfo13+NLluPvM/vhRvw8tuNNkPorP6VnXnL3nSWu2oscNheYY6/98co5hBF3GtLfV4Z/B+ov9P2a6fxz7XSI/u+b5kEYXxZ0vvSUfeQscdNO+Jwl/2YDnoVOel/ug0IaGiMP+2seZ7p/LwDa7/S1Kuzfl09AuR8b574N1vi+cwUoRD9/eBlnds9O+JIF/0lTngWanNsyI/58BimDGvH64PYLMTZvUm0/Jln+unISFIsvHr+NM33tr/Q6XPfPs4cgF505cNWC76Qx1y5djn413ht7d/77+xdhxO9PHy5Wpp4PNnoeafg8TPdZkOazANVnPgrPPGSfuog/chS9ayN4xZz7hBHHXj3W2Socy+P8/4ATBcIIIOvlhVOHwm1PeGnc9lW946V420P2tovkTQexG7aCVyx5z5lxHTPk2KPLMl+VdZql2sNLF+CBjZJTb2/fsMXLcIe93Dkn6YsOEudtRM5ZCZwx4z1mxHlQn22bFutMZdYpBtLnt26E60dxBUT0wZH922PcF5rJrDYU3mrIt8eQZ7sO1xoN9nmq7P1KnHOcDZ8f3YesH4sRoGB78+rKqkWbkoNmOehOsFTvtVSfYqm62Nvi9KS2T08foenHbgSmIvwiACPu1otCSuPAAAAAAElFTkSuQmCC);\r\n                background-repeat:no-repeat\r\n                }                \r\n                p.testOk{\r\n                cursor:hand;\r\n                width:40px;\r\n                height:40px;\r\n                background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMTSURBVDhPpdTrL5tRGABw/80+LCKzGHHJqEt19KWoy2sW0a5D0a6hVcWoKu26Tlt1p1Uzd6WoqdVtQ0vEZW6xi2UXsw3r0FKq3ZHKeGUfljgfTvKcnF+ec3nOcbBdoTlcwdou40+/PopHH5M74sk98TQNiTbwIFF5l/AspnRE+O33xqVMCDz+YZSiJNS9kejML7XW7o49heyLRPqWx5t9lNabAEl9VXMdF/05nlx/laFOntjVLNp0mpPOpu2qinWBcInDm83h6JlsPYMxmOwvdG+davzrz/DW/k+mmqI3audt471HLfWbUtEKt3g2m62n502ms8aoJCVM6U8gq+K9i1zefV+z+zPct9QlneMt2CbUx62yjVLhIrtAz8h9TWONpmWOpOLlgUINV7XaTu0hRlRj0ptTEZimSho6UA1alYrNspJlDkjIGqMwhlPp2mRcbUC+imk5sZgth6x+WqwiNLgEhcDUgfv9lrbmnRrRKjdjKDFrNI0xlJKhJUfUBWYr0/cP944sR5U6UVwjLlaB8+a7IDBdS+4yNoITki7zRSM8WAFlDqfg5RhmB/Xw+ABMrdZJIhvuwIoQWB7iK3BDYEofESy4eD57Zkt3bDlmd2ehSz0y2ykms8lqtVZPlUUqMEBG1WHxNUE+fFcEJrZHi1YKOdPMp9PcXbPBZDYWdLNMR0YwqUYvDZej4QYoqi4ovCowtDzAi+uMwLm9dLaOXqBjUDUEsY5nXypotfqyMHlAjAKKkmGBDCnzDxb7YAS3EXhwWU3qjM0Ze5g+kJigjJTNVHw1fC7S5obL0HA9FuSMOJV+kAQF7lmsESCwwWSIKscS26IpfYQkZVxcM47YAoOjjpaDTWJwlWhI6hcsQaGfeLrmOa5triIwCNQLKh/erbiGMFIbHP8cD8ux0TIsKAlcBRoq9Q0WowIEns7Z10pe8C+Xpz3WLKqhEn9QwJAUFVaBxlcHgR57mtDLvcDJJfe6RCP898Owj+7sb7dPN5Fk99zyHd3ZTh6FN0DvxblJries/3h/UZ7X9qXR/wyv9JP8AUelhZbR6oNqAAAAAElFTkSuQmCC);\r\n                background-repeat:no-repeat\r\n                }\r\n                p.testIgnore{\r\n                cursor:hand;\r\n                width:40px;\r\n                height:40px;\r\n                background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJeSURBVDhPY/hPAWDApfff328EjcWu+de3J49PWD47a3lym/Xlk0txmYJd89s7kz48UvnxLfDKEb4p1ZJ//vzGqh+L5r+/Pzw5ZfLvj+P//57//0tOreY+f2QWsZo/Pel9f8/h3//QRw9k//6TO7aTc26rGlGa//x8+vK83f+/BQsW+SnKa/d1G/z/zzetmvPCifWY+tGd/eH+1E/3ff//r01MtmFg8A3xsv7/X2j/GqbZLToENP/99fHJSZd/v5r+/8/sbjNkYkiY1a3+/z//15fcE8q47t44jqYfxeZPj2e/ueXz/3/v//+uuzbJKfA3Xjyi9P8Py9/v4ptnsM7rcsCp+d/fj8/Oevz6Vvz/f97//2pHDonqyMfdvSL4/wPDrw+ib66z9ZdyPn9yB1k/wubvr5a9ugb0IVCnw/+//FcvcCV46jy/yfb/GcPPR7x/Pois6GFeNTMSi+Z/fz68OOf+/bPX//9u/z9L/H/J+v8z07NznP/fMvy/w/DzCtOv95JPz3NOLOP9/u0DXD/U5q/PV7w6L/fvv+X/TzL/H7D/e8O8eBqLvy/7poXsQJt/nWP4eovn71vRpe2sy2fEomj+8Pb+9e0W3+9I//8s9f8W2/9bzN+fMViZMjIwxBWnJP5/wfDrLMP3c4x/ngg+Pcg0sd4eRfPrp2e3T+d/tIf7xWG2J7uZHu1gen6IcXk3U1WK2/k1Zo/3MN7Zwnh/K+OjXUwv9jGu6xdH0fz719cbh9Jn1LBPLmMDoklgcloVELFOqWCdVAZEIBEgmlrJuqBDE93PBLMuUWmbJFMAIcChwBwUNxQAAAAASUVORK5CYII=);\r\n                background-repeat:no-repeat\r\n                }\r\n                div.barContainer{width:100%;border:solid 1px black}\r\n                div.trace{font:100% Courier}\r\n                div.border{border:dotted 1px #dcdcdc;padding:2px 2px 2px 2px}\r\n                div.contents{border:dotted 1px #dcdcdc;padding:2px 2px 2px 2px;background-color:#efefef}\r\n            </style>\r\n        </head>\r\n        <body>\r\n            <a name=\'__top\' />\r\n            <h3>@@Title@@</h3>\r\n            <div class=\'contents\'>\r\n                Summary\r\n            </div>\r\n            <br />\r\n            <a name=\'totals\' />\r\n            <table id=\'tMainSummary\'  border=\'0\' width=\"1000\">\r\n                <tr>\r\n        <th width=\"40\">Percent</th>\r\n        <th width=\"150\">Status</th>\r\n        <th width=\"40\">TotalTests</th>\r\n        <th width=\"40\">Errors</th>\r\n        <th width=\"40\">Failures</th>\r\n        <th width=\"40\">NotRun</th>\r\n        <th width=\"40\">Inconclusive</th>\r\n        <th width=\"40\">Ignored</th>\r\n        <th width=\"40\">Skipped</th>\r\n        <th width=\"40\">Invalid</th>\r\n        <th width=\"40\">TimeTaken</th>\r\n                </tr>\r\n                <tr>\r\n                    <xsl:apply-templates />\r\n                </tr>\r\n            </table>\r\n            <br />\r\n            <br />\r\n            <div class=\'contents\'>\r\n                Detail\r\n            </div>\r\n            <br />\r\n            <table id=\"tSlowerMethods\" border=\'0\' width=\"1000\">\r\n                <tr>\r\n                    <th width=\"202\">TestMethod</th>\r\n                    <th width=\"58\">Status</th>\r\n                    <th width=\"661\">Message</th>\r\n                    <th width=\"79\">Duration</th>\r\n                </tr>\r\n                <xsl:for-each select=\"//test-case\">\r\n                    <tr>\r\n                        <td><xsl:value-of select=\"@name\"/></td>\r\n                        <td>\r\n                            <xsl:choose>\r\n                                <xsl:when test=\"@result = \'Success\'\">\r\n                                    <div style=\"color: #008000; font-weight: bolder\">PASS</div>\r\n                                </xsl:when>\r\n                                <xsl:otherwise>\r\n                                    <div style=\"color: #FF0000; font-weight: bolder\">FAIL</div>\r\n                                </xsl:otherwise>\r\n                            </xsl:choose>\r\n                        </td>\r\n                        <td>\r\n                            <xsl:value-of select=\"@description\"/><br />\r\n                            <xsl:value-of select=\"failure/message\"/><br />\r\n                            <xsl:value-of select=\"failure/stack-trace\"/>\r\n                        </td>\r\n                        <td><xsl:value-of select=\"@time\"/></td>\r\n                    </tr>\r\n                </xsl:for-each>\r\n            </table>\r\n        </body>\r\n    </html>\r\n    </xsl:template>\r\n \r\n    <xsl:template match=\"test-results\">\r\n        <td>\r\n            <xsl:value-of \r\n                select=\"round(((number(@total)-number(@errors)-number(@failures)-number(@not-run)-number(@inconclusive)-number(@ignored)-number(@skipped)-number(@invalid)) div @total) * 100)\"/>%\r\n        </td>\r\n        <td width=\'350px\' style=\'vertical-align:middle;font-size:200%\'>\r\n                    <table border=\"0\" width=\"100%\">\r\n                        <tr>\r\n                            <xsl:choose>\r\n                                <xsl:when test=\"round(((number(@total)-number(@errors)-number(@failures)-number(@not-run)-number(@inconclusive)-number(@ignored)-number(@skipped)-number(@invalid)) div @total) * 100) = 100\">\r\n                                    <td bgcolor=\"Green\" style=\"color: #008000\" width=\"100%\">P</td>\r\n                                </xsl:when>\r\n                                <xsl:when test=\"round(((number(@total)-number(@errors)-number(@failures)-number(@not-run)-number(@inconclusive)-number(@ignored)-number(@skipped)-number(@invalid)) div @total) * 100) = 0\">\r\n                                    <td bgcolor=\"Red\" style=\"color: #FF0000\" width=\"100%\">F</td>\r\n                                </xsl:when>\r\n                                <xsl:otherwise>\r\n                                    <td bgcolor=\"Green\" style=\"color: #008000\"><xsl:attribute name=\"width\"><xsl:value-of select=\"round(((number(@total)-number(@errors)-number(@failures)-number(@not-run)-number(@inconclusive)-number(@ignored)-number(@skipped)-number(@invalid)) div @total) * 100)\"/>%</xsl:attribute>P</td>\r\n                                    <td bgcolor=\"Red\" style=\"color: #FF0000\"><xsl:attribute name=\"width\">\r\n                                            <xsl:value-of select=\"100-round(((number(@total)-number(@errors)-number(@failures)-number(@not-run)-number(@inconclusive)-number(@ignored)-number(@skipped)-number(@invalid)) div @total) * 100)\"/>%</xsl:attribute>F</td>\r\n                                </xsl:otherwise>\r\n                            </xsl:choose>\r\n                        </tr>\r\n                    </table>\r\n        </td>\r\n        <td><xsl:value-of select=\"@total\"/></td>\r\n        <td><xsl:value-of select=\"@errors\"/></td>\r\n        <td><xsl:value-of select=\"@failures\"/></td>\r\n        <td><xsl:value-of select=\"@not-run\"/></td>\r\n        <td><xsl:value-of select=\"@inconclusive\"/></td>\r\n        <td><xsl:value-of select=\"@ignored\"/></td>\r\n        <td><xsl:value-of select=\"@skipped\"/></td>\r\n        <td><xsl:value-of select=\"@invalid\"/></td>\r\n        <td><xsl:value-of select=\"@date\"/> <xsl:value-of select=\"@time\"/></td>\r\n    </xsl:template>\r\n \r\n    </xsl:stylesheet>\r\n</pre>\r\n\r\n<p><span>好了，再通过outlook看看：</span><br>\r\n<a href=\"/resources/28-151510334544878.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/28-151510334544878.png\" /></a><br/>\r\n<br><span>搞定。</span></p>\r\n<p><span> </span></p></div>','2016-06-21 09:51:39','2016-06-21 07:44:50','PUBLISHED',13,'peng',6,'HTML'),(29,'Selenium Web Test解耦UI变化','使用Selenium进行Web UI的自动化测试是很好的选择，它支持多种语言来实现你的测试代码，也支持多种浏览器。我选择的是Selenium Web Dirver + C# + FireFox来进行开发，并且采用PageObject design pattern来组织代码，每个page对象使用page factory工厂方法生成。','<p>使用Selenium进行Web UI的自动化测试是很好的选择，它支持多种语言来实现你的测试代码，也支持多种浏览器。我选择的是Selenium Web Dirver + C# + FireFox来进行开发，并且采用PageObject design pattern来组织代码，每个page对象使用page factory工厂方法生成。</p>\r\n<p>下面的示例是描述登录页面的LoginPage类：</p>\r\n\r\n<br/>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nclass LoginPage\r\n{\r\n    private IWebDriver driver;\r\n \r\n    [FindsBy(How = How.XPath, Using = \"//input[@type=\'text\' and @name=\'userName\']\")]\r\n    private IWebElement txtUserName;\r\n \r\n    [FindsBy(How = How.Name, Using = \"userName\")]\r\n    private IWebElement txtPassword;\r\n \r\n    [FindsBy(How = How.Name, Using = \"login\")]\r\n    private IWebElement btnLogin;\r\n \r\n    public LoginPage(IWebDriver driver)\r\n    {\r\n        this.driver = driver;\r\n    }\r\n \r\n    public FindFlightsPage Do(string UserName, string Password)\r\n    {\r\n        txtUserName.SendKeys(UserName);\r\n        txtPasswowrd.SendKeys(Password);\r\n        btnLogin.Click();\r\n \r\n        return new FindFlightsPage(driver);\r\n    }\r\n}\r\n</script>\r\n\r\n<br/>\r\n<p>可以看到，每个IWebElement私有成员都描述一个LoginPage中的元素，并且使用“FindsBy”特性来描述如何定位当前元素在页面中的位置。这样，我们就可以通过Selenium提供的PageFactory类来生成对应的Page对象了：</p>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nclass Program\r\n{\r\n    static void Main()\r\n    {\r\n        IWebDriver driver = new FirefoxDriver();\r\n        driver.Navigate().GoToUrl(\"http://newtours.demoaut.com\");\r\n \r\n        LoginPage Login = new LoginPage(driver);\r\n \r\n        // initialize elements of the LoginPage class\r\n        PageFactory.InitElements(driver, Login);\r\n        // all elements in the \'WebElements\' region are now alive!\r\n        // FindElement or FindElements no longer required to locate elements\r\n \r\n        FindFlightsPage FindFlights = Login.Do(\"User\", \"Pass\");\r\n        driver.Quit();\r\n    }\r\n}\r\n</script>\r\n\r\n<p>但是这样实现的LoginPage类，如果被测系统在UI上面有变化，比如元素的ID或Name有变化，页面的结构有变化，我们就需要更改LoginPage类中的“FindsBy”特性的内容，并且重新编译测试代码，重新部署测试代码到测试环境，而且这种情况在项目初期会经常出现，势必会导致每天花费大量时间来重新更换测试环境。</p>\r\n<p>下面介绍我使用的方法，来解开页面UI的描述信息和Page类之间的耦合。\r\n这是我写的LoginPage类：</p>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing System.Text;\r\nusing System.Threading;\r\n \r\nusing OpenQA.Selenium;\r\nusing OpenQA.Selenium.Interactions;\r\nusing OpenQA.Selenium.Support.PageObjects;\r\nusing Selenium.Tools;\r\n \r\nnamespace WebTest.TestFramework\r\n{\r\n    public class LoginPage : PageBase\r\n    {\r\n        [NeedRefresh]\r\n        public IWebElement UserNameInput { get; set; }\r\n        [NeedRefresh]\r\n        public IWebElement PassWordInput { get; set; }\r\n        public IWebElement SelectLanguageLinkBar { get; set; }\r\n        public IWebElement EnglisghLanguageLink { get; set; }\r\n \r\n        public LoginPage(IWebDriver driver)\r\n        {\r\n            this.webDriver = driver;\r\n        }\r\n \r\n        public void Login(string userName, string passwd)\r\n        {\r\n            this.UserNameInput.SendKeys(userName);\r\n            this.PassWordInput.SendKeys(passwd);\r\n            this.UserNameInput.Submit();\r\n        }\r\n \r\n        public void SelectLanguage(LanguageType type)\r\n        {\r\n            Actions actions = new Actions(this.webDriver);\r\n            actions.MoveToElement(SelectLanguageLinkBar);\r\n            actions.MoveToElement(EnglisghLanguageLink);\r\n            actions.Click();\r\n            actions.Perform();\r\n        }\r\n    }\r\n}\r\n</script>\r\n<br/>\r\n<p>抽象出一个PageBase类：</p>\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing System.Text;\r\nusing OpenQA.Selenium;\r\n \r\nnamespace AFPWebTest.TestFramework\r\n{\r\n    public class PageBase\r\n    {\r\n        protected IWebDriver webDriver;\r\n    }\r\n}\r\n</script>\r\n<br/>\r\n<p>其中，NeedRefresh特性是自定义的：</p>\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nusing System;\r\n \r\nnamespace Selenium.Tools\r\n{\r\n    [AttributeUsage(AttributeTargets.Field | AttributeTargets.Property, AllowMultiple = false, Inherited = true)]\r\n    public class NeedRefreshAttribute : Attribute\r\n    { }\r\n}\r\n</script>\r\n<br/>\r\n<p>还有一个自定义的Ignore特性：</p>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nusing System;\r\n \r\nnamespace Selenium.Tools\r\n{\r\n    [AttributeUsage(AttributeTargets.Field | AttributeTargets.Property, AllowMultiple = false, Inherited = true)]\r\n    public class IgnoreAttribute : Attribute\r\n    {}\r\n}\r\n</script>\r\n<br/>\r\n<p>使用NeedRefreshAttribute描述页面元素来表示在初始化Page类之后，这个页面元素的相关属性和值素会有更改。IgnoreAttribute是指在使用PageFactory初始化页面对象时需要略过，不需要实例化的元素。</p>\r\n<p>下面，我们设计一个xml结构来描述页面中的元素：</p>\r\n<script type=\"syntaxhighlighter\" class=\"brush: xml\">\r\n<?xml version=\"1.0\"?>\r\n<Map>\r\n    <UIMaps>\r\n        <UIMap Id=\"UserNameInput\">\r\n            <By>Id</By>\r\n            <ToFind>userName</ToFind>\r\n        </UIMap>\r\n        <UIMap Id=\"PassWordInput\">\r\n            <By>Id</By>\r\n            <ToFind>password</ToFind>\r\n        </UIMap>\r\n        <UIMap Id=\"SelectLanguageLinkBar\">\r\n            <By>XPath</By>\r\n            <ToFind>//div[@id=\'formContainer\']//div[@class=\'header\']</ToFind>\r\n        </UIMap>\r\n        <UIMap Id=\"EnglisghLanguageLink\">\r\n            <By>XPath</By>\r\n            <ToFind>//div[@id=\'formContainer\']//a[contains(., \'English\')]</ToFind>\r\n        </UIMap>\r\n    </UIMaps>\r\n</Map>\r\n</script>\r\n<br/>\r\n<p>其中，每个UIMap节点描述一个页面元素，属性Id的值需要和Page类中Public的IWebElement属性名字相同，XML By节点的值和Selenium提供的By类的方法名相同，有这些值：By.ClassName, By.CssSelector, By.Id, By.LinkText, By.Name,By.TagName和By.XPath.XML ToFind节点的值是使用以上By提供的方法所传入的参数。</p>\r\n<p>下面是xml文件对应的UIMap和Map类的实现：</p>\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nusing System.Xml.Serialization;\r\n \r\nnamespace Selenium.Tools.xml\r\n{\r\n    public class UIMap\r\n    {\r\n        [XmlAttribute]\r\n        public string Id\r\n        { get; set; }\r\n \r\n        [XmlElement]\r\n        public string By\r\n        { get; set; }\r\n \r\n        [XmlElement]\r\n        public string ToFind\r\n        { get; set; }\r\n    }\r\n}\r\n \r\nusing System.Xml.Serialization;\r\n \r\nnamespace Selenium.Tools.xml\r\n{\r\n    [XmlRoot]\r\n    public class Map\r\n    {\r\n        [XmlArray]\r\n        public UIMap[] UIMaps\r\n        { get; set; }\r\n    }\r\n}\r\n</script>\r\n\r\n<br/>\r\n<p>\r\n我们就是通过这个描述Web Page的XML文件，来达到解耦测试代码和UI描述的目的。\r\n好了，下面就是具体实现PageFactory和解析UIMaps的代码:</p>\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nusing System;\r\nusing System.Linq;\r\nusing System.Reflection;\r\n \r\nusing System.Xml.Serialization;\r\nusing System.IO;\r\nusing System.Collections.Generic;\r\nusing Castle.DynamicProxy;\r\nusing Selenium.Tools.xml;\r\nusing OpenQA.Selenium;\r\nusing OpenQA.Selenium.Support.PageObjects;\r\nusing OpenQA.Selenium.Internal;\r\n \r\nnamespace Selenium.Tools\r\n{\r\n    public static class PageFactory\r\n    {\r\n        public static string UIMapFilePath { get; set; }\r\n \r\n        private static bool DoesHasAttribute(PropertyInfo propertyInfo, IList<Type> attributes)\r\n        {\r\n            foreach (Type attribute in attributes)\r\n            {\r\n                var customAttributes = propertyInfo.GetCustomAttributes(attribute, true);\r\n                if (customAttributes.Length != 0)\r\n                {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n \r\n        private static Tpage ConstructPage<Tpage>(IWebDriver driver, IList<Type> ignoreAttributes, IList<Type> fetchAttributes) where Tpage : class\r\n        { \r\n            Type type = typeof(Tpage);\r\n            ConstructorInfo constructorInfo = type.GetConstructor(BindingFlags.Instance | BindingFlags.Public,\r\n                null,\r\n                CallingConventions.HasThis,\r\n                new Type[] { driver.GetType() },\r\n                null);\r\n            Tpage pageObject = constructorInfo.Invoke(new object[] { driver }) as Tpage;\r\n \r\n            var properties = type.GetProperties(BindingFlags.Instance |\r\n                BindingFlags.Public |\r\n                BindingFlags.ExactBinding |\r\n                BindingFlags.SetProperty\r\n                );\r\n \r\n            foreach (var property in properties)\r\n            {\r\n                if (property.PropertyType.Name != \"IWebElement\" || DoesHasAttribute(property, ignoreAttributes))\r\n                {\r\n                    //Do not init webelement that marked as Ignore\r\n                    continue;\r\n                }\r\n                //When fetchAttributes==null, all property without ignore attributes need to be set\r\n                if (fetchAttributes == null || DoesHasAttribute(property, fetchAttributes))\r\n                {\r\n                    property.SetValue(\r\n                        pageObject,\r\n                        driver.FindElement(\r\n                            ParseUIMaps(type.Name,\r\n                                property.Name)),\r\n                        null);\r\n                }\r\n            }\r\n            return pageObject;\r\n        }\r\n \r\n        public static Tpage InitPage<Tpage>(IWebDriver driver) where Tpage : class\r\n        {\r\n            return ConstructPage<Tpage>(driver, new List<Type>() { typeof(IgnoreAttribute) }, null);\r\n        }\r\n \r\n        public static Tpage RefreshPage<Tpage>(IWebDriver driver) where Tpage : class\r\n        {\r\n            return ConstructPage<Tpage>(driver, new List<Type>() { typeof(IgnoreAttribute) }, new List<Type>() { typeof(NeedRefreshAttribute) });\r\n        }\r\n \r\n        private static By ParseUIMaps(string pageName, string uimapId)\r\n        {\r\n            XmlSerializer serializer = new XmlSerializer(typeof(Map));\r\n            Map map = null;\r\n            using (FileStream fileStream = new FileStream(Path.Combine(UIMapFilePath, pageName + \".xml\"), FileMode.Open))\r\n            {\r\n                map = serializer.Deserialize(fileStream) as Map;\r\n            }\r\n            if (map == null)\r\n            {\r\n                throw new Exception(\"Fail to deserialize UIMap xml file!!\");\r\n            }\r\n \r\n            var uimap = (from i in map.UIMaps where i.Id == uimapId select i).Single();\r\n            return ConstructBy(uimap);\r\n        }\r\n \r\n        private static By ConstructBy(UIMap uimap)\r\n        {\r\n            By by = null;\r\n            switch (uimap.By)\r\n            {\r\n                case \"ClassName\":\r\n                    return By.ClassName(uimap.ToFind);\r\n                case \"CssSelector\":\r\n                    return By.CssSelector(uimap.ToFind);\r\n                case \"Id\":\r\n                    return By.Id(uimap.ToFind);\r\n                case \"LinkText\":\r\n                    return By.LinkText(uimap.ToFind);\r\n                case \"Name\":\r\n                    return By.Name(uimap.ToFind);\r\n                case \"PartialLinkText\":\r\n                    return By.PartialLinkText(uimap.ToFind);\r\n                case \"TagName\":\r\n                    return By.TagName(uimap.ToFind);\r\n                case \"XPath\":\r\n                    return By.XPath(uimap.ToFind);\r\n            }\r\n            return null;\r\n        }\r\n    }\r\n}\r\n</script>\r\n<br/>\r\n<p>上面的代码通过使用反射技术，读取与Page类的名字相同的xml文件，并从中取得信息来实例化Page类的对象。</p>\r\n<p>再实现一个扩展方法，简化代码：</p>\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing System.Text;\r\nusing Selenium.Tools;\r\nusing OpenQA.Selenium;\r\n \r\nnamespace WebTest.TestFramework\r\n{\r\n    public static class UIMapperHelper\r\n    {\r\n        public static Tpage Refresh<Tpage>(this Tpage page, IWebDriver driver) where Tpage : class\r\n        {\r\n            return PageFactory.RefreshPage<Tpage>(driver);\r\n        }\r\n \r\n        public static Tpage Init<Tpage>(this Tpage page, IWebDriver driver) where Tpage : class\r\n        {\r\n            return PageFactory.InitPage<Tpage>(driver);\r\n        }\r\n    }\r\n}\r\n</script>\r\n<br/>\r\n<p>好了，testcase的代码如下(使用Nunit实现)：</p>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing System.Text;\r\n \r\nusing OpenQA.Selenium;\r\nusing OpenQA.Selenium;\r\nusing OpenQA.Selenium.Firefox;\r\nusing OpenQA.Selenium.IE;\r\nusing OpenQA.Selenium.Support.UI;\r\nusing OpenQA.Selenium.Interactions;\r\nusing OpenQA.Selenium.Remote;\r\nusing OpenQA.Selenium.Support.PageObjects;\r\n \r\nusing NUnit.Framework;\r\nusing WebTest.TestFramework;\r\nusing PageObjectFactory = Selenium.Tools.PageFactory;\r\n \r\nnamespace WebTest.TestCases\r\n{\r\n    [TestFixture]\r\n    public class BVT : WebTestBase\r\n    {\r\n        [Test]\r\n        [TestCase(\"camel\", \"123456\")]\r\n        public void LoginTest(string username, string passwd)\r\n        {\r\n            IWebDriver driver = new FirefoxDriver();\r\n            driver.Navigate().GoToUrl(\"http://172.16.1.123:8080\");\r\n \r\n            PageObjectFactory.UIMapFilePath = @\"E:\\src_test\\WebTest\\TestFramework\\UIMaps\";\r\n            LoginPage loginPage = PageObjectFactory.InitPage<LoginPage>(driver);\r\n            loginPage.SelectLanguage(LanguageType.English);\r\n \r\n            loginPage = loginPage.Refresh(driver);\r\n            loginPage.Login(username, passwd);\r\n \r\n            this.AddTestCleanup(\"Close Browser\",\r\n                () => { driver.Close(); });\r\n        }\r\n    }\r\n}\r\n</script>\r\n<br/>\r\n<p>其中，”E:\\src_test\\WebTest\\TestFramework\\UIMaps”目录包含的是描述LoginPage页面的LoginPage.xml文件。\r\n好了，以后如果LoginPage的UI有变化时，只需要修改LoginPage.xml文件，不会影响到测试代码。</p>\r\n','2016-06-21 10:52:31','2016-06-21 10:36:13','PUBLISHED',51,'peng',6,'HTML'),(31,'搭建NuGet私服','使用NuGet来管理和更新team内部共享的类库是个好方法，并将其与CI工具集成，在build的过程中对公用项目进行NuGet打包和分发。','<p>使用NuGet来管理和更新team内部共享的类库是个好方法，并将其与CI工具集成，在build的过程中对公用项目进行NuGet打包和分发。搭建NuGet私服方法如下：</p>\r\n		<p>1. 打开VS2010的Extension Manager窗口，选择NuGet Package Manager下载：<br>\r\n		<a href=\"/resources/151453183765334.png\" data-lightbox=\"image-1\" data-title=\"\"><img src=\"/resources/151453183765334.png\" alt=\"\" height=\"50%\"></a></p>\r\n		<p>2. 安装NuGet Package Manager:<br>\r\n		<a href=\"/resources/151453320956710.png\" data-lightbox=\"image-1\" data-title=\"\"><img src=\"/resources/151453320956710.png\" alt=\"\" height=\"50%\"></a></p>\r\n		<p><a href=\"/resources/151453438763944.png\" data-lightbox=\"image-1\" data-title=\"\"><img src=\"/resources/151453438763944.png\" alt=\"\" height=\"50%\"></a></p>\r\n		<p>3. 重启VS2010</p>\r\n\r\n		<p>\r\n		<a href=\"/resources/151503235011898.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151503235011898.png\" alt=\"\" height=\"10%\">\r\n		</a>\r\n		<br><br>\r\n		</p>\r\n\r\n		<p>4. 使用VS2010创建一个Empty Web Application项目：</p>\r\n		<p>\r\n		<a href=\"/resources/151453533452551.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151453533452551.png\" alt=\"\" height=\"50%\"></a><br><br></p>\r\n		<p>5. 打开Manage NuGet Packages</p>\r\n		<p>\r\n		<a href=\"/resources/151454090954339.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151454090954339.png\" alt=\"\" height=\"50%\"></a><br><br></p>\r\n		<p>6. 搜索NuGet.Server并安装：</p>\r\n		<p>\r\n		<a href=\"/resources/151454187821946.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151454187821946.png\" alt=\"\" height=\"50%\"></a><br><br></p>\r\n		<p>7. 选择刚才新建的Web Application项目，将NuGet.Server包应用到上面：</p>\r\n		<p>\r\n		<a href=\"/resources/151454269544283.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151454269544283.png\" alt=\"\" height=\"50%\">\r\n		</a><br>\r\n		<a href=\"/resources/151454358453234.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151454358453234.png\" alt=\"\" height=\"50%\"></a><br><br></p>\r\n		<p>8. 打开Web Application项目查看，发现NuGet.Server和相关依赖已经加到引用里面了，这就是NuGet的方便之处:)<br><a href=\"/resources/151454443458770.png\" data-lightbox=\"image-1\" data-title=\"\"><img src=\"/resources/151454443458770.png\" alt=\"\" height=\"60%\"></a></p>\r\n		<p>9. 打开Web Application项目的Web.config，加一个Guid到apiKey中，正如config文件comment里面说的，这个Guid是push和delete nuget包到咱们的私服时，需要使用的密码：<br>\r\n		<a href=\"/resources/151454527351106.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151454527351106.png\" alt=\"\" height=\"50%\"></a></p>\r\n		<p>10. Publish这个Web application到IIS里面，这个server就建好喽:)<br>\r\n		<a href=\"/resources/151454595329429.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151454595329429.png\" alt=\"\" height=\"50%\"></a></p>\r\n		<p>11. 测试一下website：<br>\r\n		<a href=\"/resources/151455061268282.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151455061268282.png\" alt=\"\" height=\"50%\"></a></p>\r\n		<p>12. 一切正常的话，会看到如下的页面：<br>\r\n		<a href=\"/resources/151455134854033.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151455134854033.png\" alt=\"\" height=\"20%\"></a></p>\r\n		<p> </p>\r\n		<p>13. 如上面页面显示的，访问http://hostname/nuget/Packages查看当前Server上面的nuget包：</p>\r\n		<p>\r\n		<a href=\"/resources/151457131105187.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151457131105187.png\" alt=\"\" height=\"50%\"></a></p>\r\n		<p>14. 好了，以后就可以使用nuget.exe push我们自己的nuget包到我们自己的nuget server上面了</p>\r\n		<p>15. 接着配置client端的VS2010（也就是team内每个开发人员需要配置的),打开Option，找到Package Manager -> Package Source，将我们自己建的Nuget Server的地址加到其中：<br>\r\n		<a href=\"/resources/151457059852664.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151457059852664.png\" alt=\"\" height=\"50%\"></a></p>\r\n		<p>16. 好了，再打开我们的Manage NuGet Packages，你就会看到刚刚加的InternalNuget了：<br>\r\n		<a href=\"/resources/151456460798079.png\" data-lightbox=\"image-1\" data-title=\"\">\r\n		<img src=\"/resources/151456460798079.png\" alt=\"\" height=\"50%\"></a></p>\r\n','2016-06-30 06:41:25','2016-06-30 06:12:19','PUBLISHED',17,'peng',5,'HTML'),(32,'集成NuGet Package到Jenkins CI','当我们搭建完成NuGet Server后，就要进行打包和与CI系统的集成了。\r\n首先， 建立nuspec文件，将其放置在想要生成NuGet Package的项目的同级目录下。','<p>当我们搭建完成NuGet Server后，就要进行打包和与CI系统的集成了。</p>\r\n<p>首先， 建立nuspec文件，将其放置在想要生成NuGet Package的项目的同级目录下。</p>\r\n<a href=\"/resources/151437446571357.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151437446571357.png\" height=\"%\" /></a><br/>\r\n<br/>\r\n<br/>\r\n<p>内容如下：</p>\r\n<a href=\"/resources/151446182049931.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151446182049931.png\" height=\"%\" /></a><br/>\r\n<p>dependency的id是此nuget package依赖的其他package的id，version默认为≥1.0.0.0，一般是不用特别设定的，默认就好，因为nuget package会自动将最新的依赖包一起安装。<br>在CI的build脚本中加入如下内容，来使用命令行打包：</p>\r\n<pre>C:\\NuGetServer\\NuGet.exe pack test.csproj -Properties Configuration=Release -Version 1.0.0.%latestSvnRev%\r\ncopy test.1.0.0.%latestSvnRev%.nupkg C:\\NuGetServer\\Packages /y\r\n</pre>\r\n<p>其中latestSvnRev是通过脚本取得的当前svn目录下最新的rev，用来标识对应的nuget package是哪个svn rev的，并且每当代码有更新的时候，生成的包会在VS的Manage Nuget Packages的Upldates里面出现。</p>\r\n<p>之后就把这个生成的包copy到nuget server的Packages目录下进行发布：<br><a href=\"/resources/151447266412923.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151447266412923.png\" height=\"%\" /></a><br/>\r\n</p>\r\n<p>好了，打开VS看看：</p>\r\n<p>\r\n<a href=\"/resources/151447481577450.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151447481577450.png\" height=\"50%\" /></a><br/></p>\r\n<p>这个是有代码更新了的包：</p>\r\n<p>\r\n<a href=\"/resources/151448148452832.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151448148452832.png\" height=\"50%\" /></a><br/></p>\r\n<p>\r\n完。<br/></p>','2016-07-01 09:51:54','2016-07-01 09:49:56','PUBLISHED',9,'peng',5,'HTML'),(33,'在CentOS 6.X上折腾SELinux','SELinux就是Security-Enhanced Linux的简称，安全加强的linux。传统的linux权限是对文件和目录的owner, group和other的rwx进行控制，而SELinux采用的是委任式访问控制，也就是控制一个进程对具体文件系统上面的文件和目录的访问，SELinux规定了很多的规则，来决定哪个进程可以访问哪些文件和目录。','<p>SELinux就是Security-Enhanced Linux的简称，安全加强的linux。传统的linux权限是对文件和目录的owner, group和other的rwx进行控制，而SELinux采用的是委任式访问控制，也就是控制一个进程对具体文件系统上面的文件和目录的访问，SELinux规定了很多的规则，来决定哪个进程可以访问哪些文件和目录。</p>\r\n<p>SELinux是根据进程或文件的security context来决定进程是否有权限访问文件系统的，security context由Identify:role:type三部分组成，当selinux的类型为SELINUXTYPE=targeted的时候，只有security context的type是有用的。selinux的配置文件在这里：/etc/selinux/config，内容如下：</p>\r\n<pre class=\"brush: plain\">\r\n# This file controls the state of SELinux on the system.\r\n# SELINUX= can take one of these three values:\r\n#       enforcing - SELinux security policy is enforced.\r\n#       permissive - SELinux prints warnings instead of enforcing.\r\n#       disabled - SELinux is fully disabled.\r\nSELINUX=enforcing\r\n# SELINUXTYPE= type of policy in use. Possible values are:\r\n#       targeted - Only targeted network daemons are protected.\r\n#       strict - Full SELinux protection.\r\nSELINUXTYPE=targeted\r\n</pre>\r\n<p>需要安装必要的SELinux的相关工具：</p>\r\n<pre class=\"brush: bash\">yum install policycoreutils-python setools-console setroubleshoot setroubleshoot-server</pre>\r\n<p>查看当前SELinux的状态：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# getenforce\r\nEnforcing</pre>\r\n<p>状态为Enforcing就代表打开了SELinux，为disabled或permissive则需要使用下面的命令开启（permissive代表如果不符合SELinux的权限控制，则会出现warning提示信息，不会真的block进程的访问）：</p>\r\n<p>设置SELinux为Enforcing:</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# setenforce 1</pre>\r\n<p>之后，重启电脑，并等待SELinux相关文件建立完成。</p>\r\n<p>查看进程的security context：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# ps aux -Z | grep httpd\r\nunconfined_u:system_r:httpd_t:s0 root     6056  0.0  0.3  11672  3504 ?        Ss   15:31   0:03 /usr/sbin/httpd\r\nunconfined_u:system_r:httpd_t:s0 apache   6061  0.0  0.2  11804  2664 ?        S    15:31   0:00 /usr/sbin/httpd\r\nunconfined_u:system_r:httpd_t:s0 apache   6062  0.0  0.2  11672  2132 ?        S    15:31   0:00 /usr/sbin/httpd\r\nunconfined_u:system_r:httpd_t:s0 apache   6063  0.0  0.2  11804  2664 ?        S    15:31   0:00 /usr/sbin/httpd\r\nunconfined_u:system_r:httpd_t:s0 apache   6064  0.0  0.2  11804  2780 ?        S    15:31   0:00 /usr/sbin/httpd\r\nunconfined_u:system_r:httpd_t:s0 apache   6065  0.0  0.2  11672  2132 ?        S    15:31   0:00 /usr/sbin/httpd\r\nunconfined_u:system_r:httpd_t:s0 apache   6066  0.0  0.2  11672  2132 ?        S    15:31   0:00 /usr/sbin/httpd\r\nunconfined_u:system_r:httpd_t:s0 apache   6067  0.0  0.2  11672  2132 ?        S    15:31   0:00 /usr/sbin/httpd\r\nunconfined_u:system_r:httpd_t:s0 apache   6068  0.0  0.2  11672  2132 ?        S    15:31   0:00 /usr/sbin/httpd\r\nunconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 root 6845 0.0  0.0 4340 752 pts/0 S+ 18:16   0:00 grep httpd</pre>\r\n<p>查看目录的security context：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# ls -dZ /var/www/\r\ndrwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /var/www/</pre>\r\n<p>列出SELinux的统计信息，包括security context中的user，role和type，还有规则（Booleans）：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# seinfo\r\n\r\nStatistics for policy file: /etc/selinux/targeted/policy/policy.24\r\nPolicy Version & Type: v.24 (binary, mls)\r\n\r\n   Classes:            81    Permissions:       235\r\n   Sensitivities:       1    Categories:       1024\r\n   <strong>Types: 3488</strong>    Attributes:        273\r\n   <strong>Users: 9</strong>    <strong>Roles: 12</strong>\r\n   <strong>Booleans: 187</strong>    Cond. Expr.:       222\r\n   Allow:          273920    Neverallow:          0\r\n   Auditallow:         96    Dontaudit:      199904\r\n   Type_trans:      23469    Type_change:        38\r\n   Type_member:        48    Role allow:         20\r\n   Role_trans:        291    Range_trans:      3993\r\n   Constraints:        87    Validatetrans:       0\r\n   Initial SIDs:       27    Fs_use:             22\r\n   Genfscon:           81    Portcon:           426\r\n   Netifcon:            0    Nodecon:             0\r\n   Permissives:        59    Polcap:              2\r\n</pre>\r\n<p>查看所有的规则名字：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# seinfo -b\r\nConditional Booleans: 187\r\n   allow_domain_fd_use\r\n   allow_ftpd_full_access\r\n   allow_sysadm_exec_content\r\n   allow_user_exec_content\r\n   allow_zebra_write_config\r\n   cdrecord_read_content\r\n   fcron_crond\r\n   httpd_manage_ipa\r\n   httpd_use_openstack\r\n   mmap_low_allowed\r\n   samba_share_fusefs\r\n   sepgsql_enable_users_ddl\r\n   abrt_handle_event\r\n   allow_ftpd_use_cifs\r\n   allow_httpd_mod_auth_pam\r\n   allow_java_execstack\r\n   cron_can_relabel\r\n.......\r\n</pre>\r\n<p>查看一个规则是否打开：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# getsebool httpd_enable_homedirs\r\nhttpd_enable_homedirs --> off\r\n</pre>\r\n<p>打开一个规则：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# setsebool -P httpd_enable_homedirs=1\r\n[root@centos ~]# getsebool httpd_enable_homedirs\r\nhttpd_enable_homedirs --> on\r\n</pre>\r\n<p>查看一个规则的具体信息(也就是allow或者deny某个进程的security context的type访问某个文件系统的security context的type）：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# sesearch -b httpd_enable_homedirs --all\r\nERROR: Cannot get avrules: Neverallow rules requested but not available\r\nFound 46 semantic av rules:\r\n   allow httpd_sys_script_t home_root_t : dir { getattr search open } ; \r\n   allow httpd_sys_script_t home_root_t : lnk_file { read getattr } ; \r\n   allow httpd_suexec_t user_home_dir_t : dir { getattr search open } ; \r\n   allow httpd_suexec_t user_home_dir_t : lnk_file { read getattr } ; \r\n   allow httpd_suexec_t autofs_t : dir { ioctl read getattr lock search open } ; \r\n   allow httpd_suexec_t cifs_t : file { ioctl read getattr lock execute execute_no_trans open } ; \r\n   allow httpd_suexec_t cifs_t : dir { ioctl read getattr lock search open } ; \r\n   allow httpd_suexec_t cifs_t : lnk_file { read getattr } ; \r\n   allow httpd_suexec_t nfs_t : file { ioctl read getattr lock execute execute_no_trans open } ; \r\n   allow httpd_suexec_t nfs_t : dir { ioctl read getattr lock search open } ; \r\n   allow httpd_suexec_t nfs_t : lnk_file { read getattr } ; \r\n   allow httpd_t user_home_t : file { ioctl read getattr lock open } ; \r\n.............\r\n</pre>\r\n<p>selinux在文件系统中是存在很多的默认设置的，可以通过semanage来查看系统中所有目录的默认security context:</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# semanage fcontext -l\r\nSELinux fcontext                                   type               Context\r\n\r\n/                                                  directory          system_u:object_r:root_t:s0 \r\n/.*                                                all files          system_u:object_r:default_t:s0 \r\n/[^/]+                                             regular file       system_u:object_r:etc_runtime_t:s0 \r\n/\\.autofsck                                        regular file       system_u:object_r:etc_runtime_t:s0 \r\n/\\.autorelabel                                     regular file       system_u:object_r:etc_runtime_t:s0 \r\n/\\.journal                                         all files          <>\r\n/\\.suspended                                       regular file       system_u:object_r:etc_runtime_t:s0 \r\n/a?quota\\.(user|group)                             regular file       system_u:object_r:quota_db_t:s0 \r\n/afs                                               directory          system_u:object_r:mnt_t:s0 \r\n/bin                                               directory          system_u:object_r:bin_t:s0 \r\n/bin/.*                                            all files          system_u:object_r:bin_t:s0 \r\n/bin/alsaunmute                                    regular file       system_u:object_r:alsa_exec_t:s0 \r\n/bin/bash                                          regular file       system_u:object_r:shell_exec_t:s0 \r\n...............\r\n</pre>\r\n<p>增加一个目录的默认security context：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# semanage fcontext -a -t public_content_t \"/srv/test(/.*)?\"\r\n</pre>\r\n<p>上面这个命令将/srv/test的默认的security context的type设置为public_content_t</p>\r\n<p>改变一个文件的security context：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# chcon -t var_t /var/www/html/index.html \r\n[root@centos ~]# ll -Z /var/www/html/index.html \r\n-rw-r--r--. root root unconfined_u:object_r:var_t:s0   /var/www/html/index.html\r\n</pre>\r\n<p>上面的命令将/var/www/html/index.html的type改为var_t</p>\r\n<p>可以使用restorecon命令将档案恢复为所在目录的默认security context：<br>先查看一下/var/www的默认context是什么：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# semanage fcontext -l | grep /var/www\r\n<strong>/var/www(/.*)?                                     all files          system_u:object_r:httpd_sys_content_t:s0 </strong>\r\n/var/www/[^/]*/cgi-bin(/.*)?                       all files          system_u:object_r:httpd_sys_script_exec_t:s0 \r\n/var/www/apcupsd/multimon\\.cgi                     regular file       system_u:object_r:httpd_apcupsd_cgi_script_exec_t:s0 \r\n/var/www/apcupsd/upsfstats\\.cgi                    regular file       system_u:object_r:httpd_apcupsd_cgi_script_exec_t:s0 \r\n.............\r\n</pre>\r\n<p>使用restorecon恢复/var/www的所有档案和目录为默认：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# restorecon -Rv /var/www\r\nrestorecon reset /var/www/html/index.html context unconfined_u:object_r:var_t:s0->unconfined_u:object_r:httpd_sys_content_t:s0\r\n</pre>\r\n<p>——————————————————————————————<br>selinux是提供日志文件来记录错误信息的，错误信息记录在/var/log/messages 和 /var/log/setroubleshoot/* 里头，需要重启auditd服务来开启selinux的log服务：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# /etc/init.d/auditd restart\r\n</pre>\r\n<p>查看selinux的错误信息：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# cat /var/log/messages | grep setroubleshoot\r\nAug  9 17:46:47 centos yum[6590]: Installed: setroubleshoot-plugins-3.0.40-1.el6.noarch\r\nAug  9 17:46:50 centos yum[6590]: Installed: setroubleshoot-server-3.0.47-3.el6_3.i686\r\nAug  9 17:46:54 centos yum[6590]: Installed: setroubleshoot-3.0.47-3.el6_3.i686\r\nAug  9 17:58:57 centos setroubleshoot: SELinux is preventing /usr/sbin/httpd from getattr access on the file /var/www/html/index.html. For complete SELinux messages. run sealert -l c7a436a1-a114-4659-91a9-4155b1003dd7\r\nAug  9 17:58:58 centos setroubleshoot: SELinux is preventing /usr/sbin/httpd from getattr access on the file /var/www/html/index.html. For complete SELinux messages. run sealert -l c7a436a1-a114-4659-91a9-4155b1003dd7\r\nAug  9 18:00:35 centos setroubleshoot: SELinux is preventing /usr/sbin/httpd from getattr access on the file /var/www/html/index.html. For complete SELinux messages. run sealert -l c7a436a1-a114-4659-91a9-4155b1003dd7\r\nAug  9 18:00:36 centos setroubleshoot: SELinux is preventing /usr/sbin/httpd from getattr access on the file /var/www/html/index.html. For complete SELinux messages. run sealert -l c7a436a1-a114-4659-91a9-4155b1003dd7\r\n</pre>\r\n<p>运行sealert查看具体解决方法：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# sealert -l c7a436a1-a114-4659-91a9-4155b1003dd7\r\nSELinux is preventing /usr/sbin/httpd from getattr access on the file /var/www/html/index.html.\r\n\r\n*****  Plugin restorecon (99.5 confidence) suggests  *************************\r\n\r\nIf you want to fix the label. \r\n/var/www/html/index.html default label should be httpd_sys_content_t.\r\nThen you can run restorecon.\r\nDo\r\n<strong># /sbin/restorecon -v /var/www/html/index.html</strong>\r\n\r\n*****  Plugin catchall (1.49 confidence) suggests  ***************************\r\n\r\nIf you believe that httpd should be allowed getattr access on the index.html file by default.\r\nThen you should report this as a bug.\r\nYou can generate a local policy module to allow this access.\r\nDo\r\nallow this access for now by executing:\r\n# grep httpd /var/log/audit/audit.log | audit2allow -M mypol\r\n# semodule -i mypol.pp\r\n\r\n</pre>\r\n<p>上面的信息已经给出了具体解决方法，就是使用restorecon将index.html恢复为默认。</p>\r\n<p>——————————————————————————————<br>下面用httpd这个www服务简单实验一下：<br>没装httpd的就先装吧。。</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# yum install httpd\r\nLoaded plugins: fastestmirror, refresh-packagekit, security\r\nLoading mirror speeds from cached hostfile\r\n * base: mirrors.ta139.com\r\n * extras: mirrors.ta139.com\r\n * updates: mirrors.ta139.com\r\nSetting up Install Process\r\nPackage httpd-2.2.15-15.el6.centos.1.i686 already installed and latest version\r\nNothing to do\r\n</pre>\r\n<p>启动httpd service：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# /etc/init.d/httpd restart\r\nStopping httpd:                                            [  OK  ]\r\nStarting httpd:                                            [  OK  ]\r\n</pre>\r\n<p>查看系统是否启动了80端口监听:</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# netstat -tupln | grep httpd\r\ntcp        0      0 :::80                       :::*                        LISTEN      9587/httpd     \r\n</pre>\r\n<p>在root的家目录创建index.html文件：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# echo \"Test for selinux\" > index.html \r\n</pre>\r\n<p>查看它的context:</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# ls -Z index.html \r\n-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 index.html\r\n</pre>\r\n<p>可以看到它的type为admin_home_t，是继承自/root这个目录的security context</p>\r\n<p>把它copy到/var/www/html中：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# cp -a index.html  /var/www/html/\r\n</pre>\r\n<p>注意，我们使用的是-a这个option来copy，也就是我们保留了源文件的security context:</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# ll -Z /var/www/html/index.html \r\n-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 /var/www/html/index.html\r\n</pre>\r\n<p>使用links访问一下这个page:</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# links http://localhost/index.html -dump\r\n                                   Forbidden\r\n\r\n   <strong>You don\'t have permission to access /index.html on this server.</strong>\r\n\r\n   --------------------------------------------------------------------------\r\n\r\n    Apache/2.2.15 (CentOS) Server at localhost Port 80\r\n</pre>\r\n<p>意料之中，出现permission deny了，这个时候是可以直接去看/var/log/messages来解决问题的。</p>\r\n<p>我们这里先查看一下进程httpd的context：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# ps aux -Z | grep httpd\r\nunconfined_u:system_r:httpd_t:s0 apache   9590  0.0  0.2  11804  2852 ?        S    10:38   0:00 /usr/sbin/httpd\r\n</pre>\r\n<p>再查看一下有没有允许httpd访问type为admin_home_t的文件：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# sesearch --all | grep \"allow httpd_t admin_home_t\"\r\nERROR: Cannot get avrules: Neverallow rules requested but not available\r\n</pre>\r\n<p>查询结果显示，没有这个rule，所以httpd进程被block。</p>\r\n<p>查看有没有允许httpd访问type为httpd_sys_content_t的文件：</p>\r\n<pre class=\"brush: bash\">root@centos ~]# sesearch --all | grep \"allow httpd_t httpd_sys_content_t\"\r\nERROR: Cannot get avrules: Neverallow rules requested but not available\r\n   allow httpd_t httpd_sys_content_t : file { ioctl read getattr lock open } ; \r\n   allow httpd_t httpd_sys_content_t : dir { ioctl read getattr lock search open } ; \r\n   allow httpd_t httpd_sys_content_t : lnk_file { read getattr } ; \r\n   allow httpd_t httpd_sys_content_t : file { ioctl read getattr lock open } ; \r\n   allow httpd_t httpd_sys_content_t : dir { ioctl read getattr lock search open } ; \r\n   allow httpd_t httpd_sys_content_t : dir { ioctl read write getattr lock add_name remove_name search open } ; \r\n   allow httpd_t httpd_sys_content_t : lnk_file { read getattr } ; \r\n</pre>\r\n<p>好了，恢复/var/www/html/index.html吧：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# restorecon -Rv /var/www/html/\r\nrestorecon reset /var/www/html/index.html context unconfined_u:object_r:admin_home_t:s0->unconfined_u:object_r:httpd_sys_content_t:s0\r\n</pre>\r\n<p>在访问一次：</p>\r\n<pre class=\"brush: bash\">[root@centos ~]# links http://localhost/index.html -dump\r\n   Test for selinux\r\n</pre>\r\n<p>OK了。</p>','2016-07-01 10:07:10','2016-07-01 10:04:10','PUBLISHED',9,'peng',11,'HTML'),(34,'Apache的Order Allow Deny总结','Apache关于Order Allow Deny的配置搞得我很混乱，总结一下吧。','<p>Apache关于Order Allow Deny的配置搞得我很混乱，总结一下吧：</p>\r\n<pre class=\"brush: xml\">\r\n<Directory \"/var/www/html\">\r\n \r\n#\r\n# Possible values for the Options directive are \"None\", \"All\",\r\n# or any combination of:\r\n#   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews\r\n#\r\n# Note that \"MultiViews\" must be named *explicitly* --- \"Options All\"\r\n# doesn\'t give it to you.\r\n#\r\n# The Options directive is both complicated and important.  Please see\r\n# http://httpd.apache.org/docs/2.2/mod/core.html#options\r\n# for more information.\r\n#\r\n    Options Indexes FollowSymLinks\r\n \r\n#\r\n# AllowOverride controls what directives may be placed in .htaccess files.\r\n# It can be \"All\", \"None\", or any combination of the keywords:\r\n#   Options FileInfo AuthConfig Limit\r\n#\r\n    AllowOverride None\r\n \r\n#\r\n# Controls who can get stuff from this server.\r\n#\r\n  Order deny,allow\r\n</Directory>\r\n</pre>\r\n<p>总则：</p>\r\n<p>影响最终判断结果的只有两点：</p>\r\n<p>1. order语句中allow、deny的先后顺序；</p>\r\n<p>2. allow、deny语句中各自包含的范围。<br><br>提醒：</p>\r\n<p>1. 修改完配置后要保存好并重启Apache服务，配置才能生效；</p>\r\n<p>2. 开头字母不分大小写；</p>\r\n<p>3. allow、deny语句不分先后顺序，谁先谁后不影响最终判断结果；但都会被判断到；</p>\r\n<p>4. order语句中，“allow,deny”之间“有且只有”一个逗号（英文格式的），而且先后顺序很重要；</p>\r\n<p>5. Apache有一条缺省规则，“order allow,deny”本身就默认了拒绝所有的意思，因为deny在allow的后面；同理，“order deny,allow”本身默认的是允许所有；当然，最终判断结果还要综合下面的allow、deny语句中各自所包含的范围；（也就是说order语句后面可以没有allow、deny语句）</p>\r\n<p>6. allow、deny语句中，第二个单词一定是“from”，否则Apache会因错而无法启动，</p>\r\n<p>7. “order allow,deny”代表先判断allow语句再判断deny语句，反之亦然。</p>\r\n<p>上面说的都是要记住的，而下面说的是我独创的理解方法。如果有人看了而没有豁然开朗的感觉，那算是我的失败！</p>\r\n<p>判断原则分4步走：</p>\r\n<p>1. 首先判断默认的；</p>\r\n<p>2. 然后判断逗号前的；</p>\r\n<p>3. 最后判断逗号后的；</p>\r\n<p>4. 最终按顺序叠加而得出判断结果。</p>\r\n<p>上面三点我说的简单而形象，主要是为了便于记忆。暂时不理解不要紧，继续看下面详细的解说自然会明白。下面以一个普通例子来做解释：</p>\r\n<p>order deny,allow</p>\r\n<p>allow from 218.20.253.2</p>\r\n<p>deny from 218.20</p>\r\n<p>1. 所谓“首先判断默认的”，就是判断“order deny,allow”这句，它默认是允许所有；</p>\r\n<p>2. 所谓“然后判断逗号前的”，因为在本例子中的order语句里面，deny在逗号的前面，所以现在轮到判断下面的deny语句了——“deny from 218.20”；</p>\r\n<p>3. 所谓“最后判断逗号后的”，因为在本例子中的order语句里面，allow在逗号的后面，所以最后轮到判断下面的allow语句了——“allow from 218.20.253.2”。</p>\r\n<p>4. 所谓“最终按顺序叠加而得出判断结果”，这是一个形象化了的说法，我把每一步判断都看作一个“不透明的图层”，然后一步步按顺序叠加上去，最终得出的“图像”就是判断结果。</p>\r\n<p>用过作图软件的人应该都知道“图层”是怎么回事，我估计Apache关于order allow deny这方面的设计理念和photoshop等作图软件关于图层的设计理念是一样的。即“游戏规则”是一样的。</p>\r\n<p>那么上面的例子就可以是这么一个步骤和图像——</p>\r\n<p>1. 先画一个白色的大圆作为背景色，代表“order deny,allow”语句，默认意思是允许所有；</p>\r\n<p>2. 然后在白色背景上面画一个小一点的黑色圆，代表“deny from 218.20”语句，意思是拒绝所有以218.20开头的IP，放进白色的大圆里面；</p>\r\n<p>3. 最后再在这个黑色圆上面点一个白点，代表“allow from 218.20.253.2”语句，意思是允许218.20.253.2通过。</p>\r\n<p>4. 到此为止，我们已经可以看到一个结果了，白色大圆上面有一个黑色圆，黑色圆上面还有一个白点。最后，我们所能看到的黑色部分就是拒绝通行的，剩下的白色部分都是允许通行的。判断的结果就是这么简单形象！</p>\r\n<p>在这里再啰嗦一下，allow、deny语句后面跟的参数有多种形式，有不同的表达方式，我在网上看到的做法是deny from IP1 IP2 IP3或allow from domain.com等。其它的表达方式大家再找别的资料看吧。我想说的是另一种表达方式：</p>\r\n<p>order deny,allow</p>\r\n<p>allow from IP1 IP2</p>\r\n<p>allow from domain.info</p>\r\n<p>allow from 219.20.55.0/24</p>\r\n<p>deny from all</p>\r\n<p>我没具体验证过这是否对，不过这样是可以正常启动Apache服务的，按道理应该是正确的表达方式。哈哈，像我这样的入门者只能这样了，还希望大家多多指教！<br>下面是测试过的例子：<br>——————————–<br>Order deny,allow<br>allow from all<br>deny from 219.204.253.8<br>#全部都可以通行<br>——————————-<br>Order deny,allow<br>deny from 219.204.253.8<br>allow from all<br>#全部都可以通行<br>——————————-<br>Order allow,deny<br>deny from 219.204.253.8<br>allow from all<br>#只有219.204.253.8不能通行</p>\r\n<p>具体分析一下：<br>1、由Order allow,deny得出是默认deny all，那么就是说，这个图的背景全部是黑色的；<br>2、先分析allow的规则，<br>allow from all，代表把黑色背景全部涂白；<br>3、再分析deny的规则，<br>deny from 219.204.253.8， 代表在全部涂白的背景上面点一个黑点；</p>\r\n<p>好了，最终的规则就是：只有219.204.253.8不能通行</p>\r\n<p>——————————-<br>Order allow,deny<br>allow from all<br>deny from 219.204.253.8<br>#只有219.204.253.8不能通行<br>——————————-<br>——————————-<br>Order allow,deny<br>deny from all<br>allow from 219.204.253.8<br>#全部都不能通行</p>\r\n<p>具体分析一下：<br>1、由Order allow,deny得出是默认deny all，那么就是说，这个图的背景全部是黑色的；<br>2、先分析allow的规则，<br>allow from 219.204.253.8，代表在黑色背景上面点一个白点；<br>3、再分析deny的规则，<br>deny from all， 代表所有全部涂黑，自然也覆盖了那个白点了；</p>\r\n<p>好了，最终的规则就是：全部都不能通行<br>——————————-<br>Order allow,deny<br>allow from 219.204.253.8<br>deny from all<br>#全部都不能通行<br>——————————-<br>Order deny,allow<br>allow from 219.204.253.8<br>deny from all<br>#只允许219.204.253.8通行<br>——————————-<br>Order deny,allow<br>deny from all<br>allow from 219.204.253.8<br>#只允许219.204.253.8通行<br>——————————-<br>——————————–<br>Order deny,allow<br>#全部都可以通行（默认的）<br>——————————-<br>Order allow,deny<br>#全部都不能通行（默认的）<br>——————————-<br>Order allow,deny<br>deny from all<br>#全部都不能通行<br>——————————-<br>Order deny,allow<br>deny from all<br>#全部都不能通行<br>——————————-<br>对于上面两种情况，如果换成allow from all，则全部都可以通行！<br>——————————-<br>Order deny,allow<br>deny from 219.204.253.8<br>#只有219.204.253.8不能通行<br>——————————-<br>Order allow,deny<br>deny from 219.204.253.8<br>#全部都不能通行<br>——————————-<br>Order allow,deny<br>allow from 219.204.253.8<br>#只允许219.204.253.8通行<br>——————————-<br>Order deny,allow<br>allow from 219.204.253.8<br>#全部都可以通行<br>——————————-<br>——————————-<br>order deny,allow<br>allow from 218.20.253.2<br>deny from 218.20<br>#代表拒绝218.20开头的IP，但允许218.20.253.2通过；而其它非218开头的IP也都允许通过。<br>——————————-<br>order allow,deny<br>allow from 218.20.253.2<br>deny from 218.20<br>#和上面的差不多，只是掉换的order语句中的allow、deny先后顺序，但最终结果表示全部都拒绝！</p>\r\n<p>具体分析一下：<br>1、由Order allow,deny得出是默认deny all，那么就是说，这个图的背景全部是黑色的；<br>2、先分析allow的规则，<br>allow from 218.20.253.2，代表在黑色背景上面点一个白点；<br>3、再分析deny的规则，<br>deny from 218.20， 代表涂黑所有218.20.*.*的ip，自然也把218.20.253.2给覆盖了，由于背景就是黑色的，所以都是黑色的了，最终结果表示全部都拒绝。</p>\r\n','2016-07-01 10:50:09','2016-07-01 10:46:30','PUBLISHED',8,'peng',11,'HTML'),(35,'Linux下简单防火墙的设置','对于个人VPS来说，简单的防火墙设置也是有必要的。','<p>对于个人VPS来说，简单的防火墙设置也是有必要的，具体方法如下：</p>\r\n<p>1. 先检查一下防火墙的功能是否开启：<br>\r\n<pre class=\"brush: bash\">\r\n# /etc/init.d/iptables status\r\n</pre>\r\n</p>\r\n<p>2. 设定输入、输出和转发三个链的预设政策：<br>\r\n<pre class=\"brush: bash\">\r\n# iptables -P INPUT ACCEPT\r\n# iptables -P OUTPUT ACCEPT\r\n# iptables -P FORWARD ACCEPT\r\n</pre>\r\n</p>\r\n<p>4. 设定loopback接口不受然后限制：<br>\r\n<pre class=\"brush: bash\">\r\n# iptables -A INPUT -i lo -j ACCEPT\r\n</pre>\r\n</p>\r\n<p>5. 设定开放所有由本机发出去的请求的响应包<br>\r\n<pre class=\"brush: bash\">\r\n# iptables -A INPUT -m state –state RELATED,ESTABLISHED -j ACCEPT\r\n</pre>\r\n</p>\r\n<p>6. 设定放开本机提供的www服务：<br>\r\n<pre class=\"brush: bash\">\r\n# iptables -A INPUT -p TCP –dport 80 -j ACCEPT\r\n</pre>\r\n</p>\r\n<p>7. 设定放开本机提供的ssh服务：<br>\r\n<pre class=\"brush: bash\">\r\n# iptables -A INPUT -p TCP –dport 22 -j ACCEPT\r\n</pre>\r\n</p>\r\n<p>8. 设定输入链的预设政策为DROP：<br>\r\n<pre class=\"brush: bash\">\r\n# iptables -P INPUT DROP\r\n</pre>\r\n</p>\r\n<p>9. 保存这些路由信息：<br>\r\n<pre class=\"brush: bash\">\r\n# /etc/init.d/iptables save\r\n</pre>\r\n</p>\r\n<p>注：<br>需要先设定输入链的预设政策为ACCEPT, 给自己留一条后路，免得ssh连接被防火墙block，那样的话，就只能想办法重启服务器，或者跑到服务器上tty登录了。所以，还是先把INPUT政策置为ACCEPT，再进行防火墙的操作，最后再执行”iptables -P INPUT DROP”。</p>','2016-07-01 10:55:43','2016-07-01 10:55:43','PUBLISHED',12,'peng',11,'HTML'),(36,'常用GDB命令','记录一下常用的GDB命令','<p>记录一下常用的GDB命令，</p>\r\n<p>首先要用GCC -g编译：</p>\r\n<pre class=\"brush: bash\">gcc -g [源文件1， 源文件2...] -o [编译后的可执行文件]</pre>\r\n<p> </p>\r\n<p>启动GDB：</p>\r\n<pre class=\"brush: bash\">gdb [编译后的可执行文件]</pre>\r\n<p> <br /><br />进入GDB后的信息：</p>\r\n<pre class=\"brush: bash\">GNU gdb (Ubuntu/Linaro 7.4-2012.04-0ubuntu2) 7.4-2012.04\r\nCopyright (C) 2012 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\r\nand \"show warranty\" for details.\r\nThis GDB was configured as \"i686-linux-gnu\".\r\nFor bug reporting instructions, please see:\r\n<http://bugs.launchpad.net/gdb-linaro/>...\r\n<strong>Reading symbols from /home/peng1/Dropbox/CProgram/cpro1...done.</strong>\r\n(gdb)</pre>\r\n<p>好了，以后的命令都是在这个”(gdb)”的提示符下进行的</p>\r\n<p> </p>\r\n<p>命令<strong>list [行号]</strong>， 列出源代码，不加行号，默认从第一行开始，列出10行，再l则会列出下面的10行：</p>\r\n<pre class=\"brush: c#\">(gdb) l\r\n	#include \r\n	#define MAXLINE 1000\r\n	\r\n	int mygetline(char line[], int max);\r\n	int strindex(char source[], char searchfor[]);\r\n	\r\n	char pattern[]=\"ould\";\r\n	\r\n	int main()\r\n	{</pre>\r\n<p>命令<strong>list [文件名]:[行号]</strong>， 列出对应文件的源代码：</p>\r\n<pre  class=\"brush: c#\">(gdb) l mygetlines.c:1\r\n	#include <stdio.h>\r\n	\r\n	int mygetline(char s[], int lim)\r\n	{\r\n	    int c, i;\r\n	    i=0;\r\n	\r\n	    while(--lim>0 && (c=getchar())!=EOF && c!=\'\\n\')\r\n	    {\r\n		s[i++]=c;\r\n</pre>\r\n<p> </p>\r\n<p>加断点：</p>\r\n<pre  class=\"brush: plain\">break [行号]\r\nbreak [方法名]\r\nbreak [文件名]:[行号] </pre>\r\n<p>例如：</p>\r\n<p>输入break main</p>\r\n<pre  class=\"brush: plain\">(gdb) break main\r\nBreakpoint 1 at 0x8048470: file cpro1.c, line 10.</pre>\r\n<pre class=\"brush: plain\">(gdb) break strindex.c:2\r\nBreakpoint 3 at 0x80484f6: file strindex.c, line 2.\r\n</pre>\r\n<p> </p>\r\n<p>查看断点：</p>\r\n<pre   class=\"brush: bash\">info break</pre>\r\n<p>例如：</p>\r\n<pre  class=\"brush: bash\">(gdb) info break\r\nNum     Type           Disp Enb Address    What\r\n1       breakpoint     keep y   0x08048470 in main at cpro1.c:10</pre>\r\n<p> </p>\r\n<p>好了，断点已经加好了，可以运行了：</p>\r\n<pre class=\"brush: bash\">run [命令行参数]</pre>\r\n<p>例如：</p>\r\n<pre class=\"brush: bash\">(gdb) run\r\nStarting program: /home/peng1/Dropbox/CProgram/cpro1 \r\n\r\nBreakpoint 1, main () at cpro1.c:10\r\n10	{</pre>\r\n<p> </p>\r\n<p>单步执行：</p>\r\n<pre class=\"brush: bash\">step或s   单步执行，会跳入方法中\r\nnext或n   单步执行，不会跳入方法中</pre>\r\n<p>例如：</p>\r\n<pre class=\"brush: bash\">(gdb) s\r\n12	    int found=0;\r\n(gdb) s\r\n14	    while(mygetline(line, MAXLINE)>0)\r\n(gdb) s\r\nmygetline (s=0xbfffeec4 \"\\001\", lim=1000) at cpro1.c:29\r\n29	    i=0;\r\n(gdb) s\r\n31	    while(--lim>0 && (c=getchar())!=EOF && c!=\'\\n\')\r\n(gdb) s</pre>\r\n<p> <br />查看当前代码运行到的位置：</p>\r\n<pre class=\"brush: bash\">where\r\n</pre>\r\n<p> <br />例如：</p>\r\n<pre class=\"brush: bash\">(gdb) where\r\n#0  mygetline (s=0xbfffeec4 \"\\n\", lim=999) at cpro1.c:39\r\n#1  0x080484cf in main () at cpro1.c:14\r\n</pre>\r\n<p> <br />显示变量的值：</p>\r\n<pre class=\"brush: bash\">print [变量名]\r\np [变量名]\r\np [文件名]::[变量名]\r\n</pre>\r\n<p>例如：</p>\r\n<pre class=\"brush: bash\">(gdb) p c\r\n$1 = 10\r\n(gdb) p s\r\n$2 = 0xbfffeec4 \"\\n\"\r\n</pre>\r\n<p> <br />继续执行到下一个断点：</p>\r\n<pre class=\"brush: bash\">continue\r\nc\r\n</pre>\r\n<p> <br />退出GDB：</p>\r\n<pre class=\"brush: bash\">quit\r\nq</pre>','2016-07-01 11:16:59','2016-07-01 11:15:25','PUBLISHED',12,'peng',11,'HTML'),(37,'区分.net framework的平台类型','区分.net framework的平台类型','<p>使用CorFlags.exe来观察dll的header信息：</p>\r\n<p>1. 打开 Visual Studio command prompt.</p>\r\n<p>2. 输入 “CorFlags.exe [Assembly File Path]“.<br><br>3.	显示下面的信息:<br>Microsoft (R) .NET Framework CorFlags Conversion Tool. Version 4.0.30319.1<br>Copyright (c) Microsoft Corporation. All rights reserved.</p>\r\n<p>Version : v2.0.50727<br>CLR Header: 2.5<br>PE : PE32<br>CorFlags : 1<br>ILONLY : 1<br>32BIT : 0<br>Signed : 0</p>\r\n<p>4.	查看下面的表，来决定是否为32，64还是anycpu:<br>anycpu: PE = PE32 and 32BIT = 0<br>x86: PE = PE32 and 32BIT = 1<br>64-bit: PE = PE32+ and 32BIT = 0</p>','2016-07-01 14:48:16','2016-07-01 14:43:12','PUBLISHED',8,'peng',12,'HTML'),(38,'集成StyleCop到Jenkins CI','这是集成完stylecop之后的Jenkins，可以看到code review结果随每个build变化的图表，Build History里面可以看到#150之前的build状态是unstable，这是和stylecop review出不符合要求的数目有关的。','<p>这是集成完stylecop之后的Jenkins，可以看到code review结果随每个build变化的图表，Build History里面可以看到#150之前的build状态是unstable，这是和stylecop review出不符合要求的数目有关的：</p>\r\n<p>\r\n\r\n<a href=\"/resources/151528587982057.png\" data-lightbox=\"image-1\"    data-title=\"\">\r\n<img src=\"/resources/151528587982057.png\" alt=\"\" width=\"729\" height=\"356\"></a>\r\n\r\n</p>\r\n<p>&nbsp;</p>\r\n<p>1. 先安装<a title=\"stylecop\" href=\"http://stylecop.codeplex.com/\" shape=\"rect\" target=\"_blank\">StyleCop</a></p>\r\n<p>2. 编辑你想要进行code review扫描的项目文件*.csproj：</p>\r\n<p>\r\n<a href=\"/resources/151529382826026.png\" data-lightbox=\"image-1\"    data-title=\"\">\r\n<img src=\"/resources/151529382826026.png\" alt=\"\"></a>\r\n</p>\r\n<p>&nbsp;</p>\r\n<p>好了，现在无论我们用IDE还是MSbuild进行构建的时候，都会进行stylecop的code review检查，默认会把所有检查出的结果置为build warnings。如果想要变为build errors，可以设置环境变量或build环境变量的StyleCopTreatErrorsAsWarnings为false，也可以编辑.csproj文件，在第一个 PropertyGroup section中加入StyleCopTreatErrorsAsWarnings tag并置为false：</p>\r\n<p>\r\n<a href=\"/resources/151530060165519.png\" data-lightbox=\"image-1\"    data-title=\"\">\r\n<img src=\"/resources/151530060165519.png\" alt=\"\"></a></p>\r\n<p>&nbsp;</p>\r\n<p>3. 如果有第三方的代码或IDE自动产生的代码，则需要stylecop略过不进行扫描，有下面三种方法使其不进行code review：</p>\r\n<ul class=\" list-paddingleft-2\">\r\n<li>将文件后缀改为 “.Designer.cs”</li>\r\n<li>用C# region “generated code”括起来不想被review的代码</li>\r\n<li>把”//&lt;auto-generated /&gt;”放到代码里面</li>\r\n</ul>\r\n<p>4. Jenkins安装Jenkins Violations plugin插件：</p>\r\n<p>\r\n<a href=\"/resources/151530598452210.png\" data-lightbox=\"image-1\"    data-title=\"\">\r\n<img src=\"/resources/151530598452210.png\" alt=\"\"></a></p>\r\n<p>5. 设置Jenkins Job开启Report Violations：</p>\r\n<p>\r\n<a href=\"/resources/151647256737913.png\" data-lightbox=\"image-1\"    data-title=\"\">\r\n<img src=\"/resources/151647256737913.png\" alt=\"\"></a></p>\r\n<p>&nbsp;</p>\r\n<p>“XML filename pattern”需要指定编译项目后所产生的StyleCop的结果文件，这个文件默认是在项目的obj\\Release\\StyleCopViolations.xml，可以在build脚本中将其copy到jenkins的workspace根目录下。</p>\r\n<p>好了，以后每次build都会产生Violations的报表了，还有详细的列表可以供开发人员查看：</p>\r\n<p>\r\n<a href=\"/resources/151648082516338.png\" data-lightbox=\"image-1\"    data-title=\"\">\r\n<img src=\"/resources/151648082516338.png\" alt=\"\"></a></p>\r\n','2016-07-01 15:07:44','2016-07-01 15:02:58','PUBLISHED',26,'peng',5,'HTML'),(39,'.Net项目版本号的生成','给.Net项目编译的程序集加入版本号的方式有许多种','<p>给.Net项目编译的程序集加入版本号的方式有许多种，包括：</p>\r\n<p><strong>1. 默认的方式，在每个项目的AssemblyInfo.cs文件中指定版本号：</strong></p>\r\n\r\n<pre class=\"brush: csharp\">\r\n// Version information for an assembly consists of the following four values:\r\n//\r\n//      Major Version\r\n//      Minor Version \r\n//      Build Number\r\n//      Revision\r\n//\r\n// You can specify all the values or you can default the Build and Revision Numbers \r\n// by using the \'*\' as shown below:\r\n// [assembly: AssemblyVersion(\"1.0.*\")]\r\n[assembly: AssemblyVersion(\"1.0.0.0\")]\r\n[assembly: AssemblyFileVersion(\"1.0.0.0\")]\r\n</pre>\r\n<br/>\r\n<br/>\r\n<p><strong>2. 使用IDE的插件方式定制版本号增加的方式：</strong></p>\r\n<a href=\"/resources/151704120322664.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151704120322664.png\" height=\"%\" /></a><br/>\r\n<p> </p>\r\n<p>从上图中可以看到，这个插件可以通过根据时间信息来生产每一位的版本号</p>\r\n<p> </p>\r\n<p><strong>3. 通过T4模板在每次编译解决方案时更新项目的版本号</strong></p>\r\n<p>T4模板是一种在设计阶段帮助开发人员按照一定规则生产代码的机制，在IDE中可以添加：</p>\r\n<p>\r\n<a href=\"/resources/151704470484867.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151704470484867.png\" height=\"%\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>具体的介绍可以参考MSDN上面的：<br clear=\"none\"><a title=\"http://msdn.microsoft.com/en-us/library/bb126445(v=VS.100).aspx\" href=\"http://msdn.microsoft.com/en-us/library/bb126445(v=VS.100).aspx\" shape=\"rect\" target=\"_blank\">http://msdn.microsoft.com/en-us/library/bb126445(v=VS.100).aspx</a></p>\r\n<p>我们在这里使用T4模板的目的就是让它根据当前的subversion上的revision number生产版本号</p>\r\n<p> </p>\r\n<pre class=\"brush: csharp\">\r\nusing System.Reflection;\r\n  \r\n[assembly: AssemblyVersion(\"1.0.0.7162\")]\r\n[assembly: AssemblyFileVersion(\"1.0.0.7162\")]\r\n</pre>\r\n<p> </p>\r\n<p>其中最后一位是当前的SvnRevisionNumber</p>\r\n<p>具体操作方法如下：</p>\r\n<p>（1）为了使用T4模板，需要安装Visual Studio 2010 SP1 SDK和Visual Studio 2010 SP1 Visualization and Modeling SDK</p>\r\n<p>Visual Studio 2010 SP1 SDK的下载地址：<br clear=\"none\"><a title=\"http://visualstudiogallery.msdn.microsoft.com/25622469-19d8-4959-8e5c-4025d1c9183d\" href=\"http://visualstudiogallery.msdn.microsoft.com/25622469-19d8-4959-8e5c-4025d1c9183d\" shape=\"rect\" target=\"_blank\">http://visualstudiogallery.msdn.microsoft.com/25622469-19d8-4959-8e5c-4025d1c9183d</a></p>\r\n<p>Visual Studio 2010 SP1 Visualization and Modeling SDK的下载地址：<br clear=\"none\"><a title=\"http://www.microsoft.com/en-us/download/details.aspx?id=23025\" href=\"http://www.microsoft.com/en-us/download/details.aspx?id=23025\" shape=\"rect\" target=\"_blank\">http://www.microsoft.com/en-us/download/details.aspx?id=23025</a></p>\r\n<p>（2）在需要共享同一个版本号的解决方案中新增一个新的项目</p>\r\n<p>（3）编辑这个项目文件，加入如下内容：</p>\r\n<p> </p>\r\n<p>\r\n<a href=\"/resources/151705410959555.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151705410959555.png\" height=\"%\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>（4）在这个新项目中添加一个T4模板文件</p>\r\n<p>（5）编辑这个扩展名为tt的模板， 内容如下：</p>\r\n<p> </p>\r\n<pre class=\"brush: csharp\">\r\n<#@ template hostspecific=\"true\" language=\"C#\" #>\r\n<#@ output extension=\".cs\" #>\r\n<#@ Assembly name=\"E:\\trunk\\src\\BuildVersion\\SSvnEx-1.7002.1998\\SharpSvn\\SharpSvn.dll\" #>\r\n<#@ import namespace=\"System.IO\" #>\r\n<#@ import namespace=\"SharpSvn\" #>\r\n<#\r\n    string RevisionNumber = String.Empty;\r\n    SvnInfoEventArgs args;\r\n    SvnPathTarget target = SvnPathTarget.FromString(@\"E:\\trunk\\src\");\r\n    try\r\n    {\r\n        new SvnClient().GetInfo(target, out args);\r\n        RevisionNumber = args.LastChangeRevision.ToString();\r\n    }\r\n    catch (SvnWorkingCopyPathNotFoundException)\r\n    {\r\n        RevisionNumber = \"0\";\r\n    }\r\n#>\r\n// \r\n// This code was generated by a tool. Any changes made manually will be lost\r\n// the next time this code is regenerated.\r\n// \r\n \r\nusing System.Reflection;\r\n \r\n[assembly: AssemblyVersion(\"1.0.0.<#= RevisionNumber #>\")]\r\n[assembly: AssemblyFileVersion(\"1.0.0.<#= RevisionNumber #>\")]\r\n</pre>\r\n\r\n<p>上面的代码使用SharpSvn类库来读取指定目录下的svn信息，并将LastChangeRevision作为最后一位的版本号。</p>\r\n<p><code><br clear=\"none\">注：<br clear=\"none\">这里的<#@ Assembly name=\"E:\\trunk\\src\\BuildVersion\\SSvnEx-1.7002.1998\\SharpSvn\\SharpSvn.dll\" #><br clear=\"none\">引用外部dll时，T4模板不能使用相对路径</code></p>\r\n<p><code>可以使用如下5中方式指定程序集的引用：</code></p>\r\n<p><code>a. 将T4需要引用的模板加入到GAC中，之后在T4中就可以直接写上程序集的名字了：<br clear=\"none\"><#@ Assembly name=\"SharpSvn.dll\" #></code></p>\r\n<p><code>b. 使用绝对路径指定程序集名字：<br clear=\"none\"><#@ Assembly name=\"E:\\trunk\\src\\BuildVersion\\SSvnEx-1.7002.1998\\SharpSvn\\SharpSvn.dll\" #></code></p>\r\n<p><code>c. 将程序集拷贝到Visual Studio的 \"Public Assemblies Folder\"中，之后在T4中就可以直接写上程序集的名字了：<br clear=\"none\"><#@ Assembly name=\"SharpSvn.dll\" #></code></p>\r\n<p><code>d. 使用一个环境变量来代替绝对路径：<br clear=\"none\"><#@ Assembly name=\"%mylib%\\SharpSvn.dll\" #></code></p>\r\n<p><code>e. 使用Visual Studio Macro来构建程序集路径：<br clear=\"none\"><#@ Assembly name=\"$(SolutionDir)lib\\SharpSvn.dll\" #><br clear=\"none\"></code></p>\r\n<p>（6）编译这个包含T4模板的项目，或者保存这个模板文件，都会触发T4生成一个cs文件，内容如下：</p>\r\n<p> </p>\r\n<p><img src=\"http://images0.cnblogs.com/blog2015/417769/201507/151707022519094.png\" alt=\"\"></p>\r\n<p> </p>\r\n<p>（7）在其他项目中添加这个生成的cs文件，以link的方式添加：</p>\r\n<p><img src=\"http://images0.cnblogs.com/blog2015/417769/201507/151707278761433.png\" alt=\"\"></p>\r\n<p> </p>\r\n<p>（8）注释掉这些项目原有的版本信息：</p>\r\n<p><img src=\"http://images0.cnblogs.com/blog2015/417769/201507/151708008607522.png\" alt=\"\"></p>\r\n<p> </p>\r\n<p>到此为止，所有引用了这个BuildVersion.cs文件的项目都会根据这个文件的内容生产版本号了，而这个版本号是来自于指定svn路径下的revision number。</p>\r\n<p><strong>4. 通过定制一个MSBuild Task，在每次编译时更新版本号信息。</strong><br clear=\"none\">MSBuild提供对复杂编译任务的可定制，我们通过继承代表一次编译任务的Task类，并重写其Execute方法来定制自己的编译任务。</p>\r\n<p>（1）首先，我们需要建立一个Class Library类型的项目，并引用下面的程序集：</p>\r\n<p><img src=\"http://images0.cnblogs.com/blog2015/417769/201507/151708363762639.png\" alt=\"\"></p>\r\n<p> </p>\r\n<p>（2）继承Task类，并实现自己的Execute方法：</p>\r\n<p>下面的代码通过读取含有版本号信息的cs文件，使用正则表达式解析出四位版本号，并实现我们自己的版本号增加逻辑，这里的逻辑是根据Jenkins的环境变量，将版本号第三位置为Jenkins的BuildNumber，将第四位置为SVN Revison号。<br clear=\"none\"><em>注：这里在处理来自svn的revision number时，当其大于UInt16.MaxValue时，我们舍弃其最高位，因为Assembly Version的值需要在0～UInt16.MaxValue之间。</em></p>\r\n<p> </p>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c#\">\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing System.Text;\r\nusing Microsoft.Build.Utilities;\r\nusing System.IO;\r\nusing System.Text.RegularExpressions;\r\n \r\nnamespace VersionInfoBuildTask\r\n{\r\n    public class AutoIncrementTask : Task\r\n    {\r\n        private const string AssemlyVersionPattern =\r\n        @\"\\[assembly: AssemblyVersion\\(\\\"\"(\\d{1}).(\\d{1}).(\\d{1,}).(\\d{1,})\"\"\\)\\]\";\r\n \r\n        private const string AssemlyFileVersionPattern =\r\n        @\"\\[assembly: AssemblyFileVersion\\(\\\"\"(\\d{1}).(\\d{1}).(\\d{1,}).(\\d{1,})\"\"\\)\\]\";\r\n \r\n        private const string AssemblyInformationalVersionPattern =\r\n        @\"\\[assembly: AssemblyInformationalVersion\\(\\\"\"(\\d{1}).(\\d{1}).(\\d{1,}).(\\d{1,})\"\"\\)\\]\";\r\n \r\n        public string AssemblyInfoPath { get; set; }\r\n \r\n        public override bool Execute()\r\n        {\r\n            try\r\n            {\r\n                if (String.IsNullOrEmpty(AssemblyInfoPath))\r\n                    throw new ArgumentException(\"AssemblyInfoPath must have a value\");\r\n \r\n                string[] content = File.ReadAllLines(AssemblyInfoPath, Encoding.Default);\r\n                var rxForAssemlyVersion = new Regex(AssemlyVersionPattern);\r\n                var rxForFileVersion = new Regex(AssemlyFileVersionPattern);\r\n                var rxForInfoVersion = new Regex(AssemblyInformationalVersionPattern);\r\n \r\n                var newContent = new List<string>();\r\n                content.ToList().ForEach(line =>\r\n                {\r\n                    if (rxForAssemlyVersion.IsMatch(line))\r\n                    {\r\n                        line = VersionMatcherForAssemlyVersion(rxForAssemlyVersion.Match(line));\r\n                        Console.Out.WriteLine(\"Match result for assembly version is: \" + line);\r\n                    }\r\n                    else if (rxForFileVersion.IsMatch(line))\r\n                    {\r\n                        line = VersionMatcherForFileVersion(rxForFileVersion.Match(line));\r\n                        Console.Out.WriteLine(\"Match result for file version is: \" + line);\r\n                    }\r\n                    else if (rxForInfoVersion.IsMatch(line))\r\n                    {\r\n                        line = VersionMatcherForInfoVersion(rxForInfoVersion.Match(line));\r\n                        Console.Out.WriteLine(\"Match result for info version is: \" + line);\r\n                    }\r\n                    else\r\n                    {\r\n                        Console.Out.WriteLine(line + \" didn\'t match!!\");\r\n                    }\r\n                    newContent.Add(line);\r\n                });\r\n \r\n                File.WriteAllLines(AssemblyInfoPath, newContent.ToArray());\r\n            }\r\n            catch (Exception ex)\r\n            {\r\n                Console.Out.WriteLine(ex);\r\n                return false;\r\n            }\r\n \r\n            return true;\r\n        }\r\n \r\n        private string VersionMatcherForFileVersion(Match match)\r\n        {\r\n            int major = int.Parse(match.Groups[1].Value);\r\n            int minor = int.Parse(match.Groups[2].Value);\r\n            int build = int.Parse(match.Groups[3].Value);\r\n            string revision = match.Groups[4].Value;\r\n \r\n            Console.WriteLine(\"AutoIncrement Assembly {0}\",\r\n                Path.GetFileName(AssemblyInfoPath));\r\n            Console.WriteLine(\"Current matched version: {0}.{1}.{2}.{3}\",\r\n                major, minor, build, revision);\r\n \r\n            string buildNumber = Environment.GetEnvironmentVariable(\"BUILD_NUMBER\");\r\n            if (buildNumber == null) buildNumber = \"0\";\r\n \r\n            string revisionNumber = Environment.GetEnvironmentVariable(\"SVN_REVISION\");\r\n            if (revisionNumber == null) revisionNumber = \"0\";\r\n            if (long.Parse(revisionNumber) > UInt16.MaxValue)\r\n            {\r\n                Console.WriteLine(\"The revision number is too big\");\r\n                long rev = long.Parse(revisionNumber);\r\n                rev = rev % 10000;\r\n                revisionNumber = rev.ToString();\r\n            }\r\n \r\n            Console.WriteLine(\"Incremented to version: {0}.{1}.{2}.{3}\",\r\n                major, minor, build, revision);\r\n \r\n            string result = match.Result\r\n                (\"[assembly: AssemblyFileVersion(\\\"$1.$2.{0}.{1}\\\")]\");\r\n            return String.Format(result, buildNumber, revisionNumber);\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n\r\n<p>（3）准备一个proj文件，这个文件是运行msbuild时需要指定的，主要是告知msbuild实现定制任务的程序集在哪里，和定制任务的输入文件在哪里：</p>\r\n<pre class=\"brush: xml\">\r\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\r\n<Project ToolsVersion=\"4.0\" DefaultTargets=\"IncrementBuild\" \r\n    xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\">\r\n    <UsingTask AssemblyFile=\"VersionInfoBuildTask.dll\" TaskName=\"AutoIncrementTask\" />\r\n    <Target Name=\"IncrementBuild\">\r\n        <AutoIncrementTask AssemblyInfoPath=\"SharedAssemblyInfo.cs\" />\r\n    </Target>\r\n</Project>\r\n</pre>\r\n<p> </p>\r\n<p>（4）准备一个包含程序集版本信息的文件，这里的SharedAssemblyInfo.cs就是将要传给定制来任务处理的文件，内容如下：</p>\r\n<p><a href=\"/resources/151710110483083.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151710110483083.png\" height=\"%\" /></a><br/></p>\r\n<p> </p>\r\n<p>（5）将SharedAssemblyInfo.cs文件加入到解决方案中，其中的所有项目都使用Add as link方式加入这个文件，以达到共享版本信息的目的 ：</p>\r\n<p>\r\n<a href=\"/resources/151710406577503.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151710406577503.png\" height=\"%\" /></a><br/></p>\r\n<p> </p>\r\n<p>（6）将编译好的VersionInfoBuildTask.dll文件，与这个proj文件都放到Jenkins的workspace目录中：</p>\r\n<p>\r\n<a href=\"/resources/151711329075007.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151711329075007.png\" height=\"%\" /></a><br/>\r\n</p>\r\n<p>并使用下面的命令来运行这个定制的Task：<br clear=\"none\">msbuild BuildTask.proj /t:IncrementBuild</p>\r\n<p>\r\n<a href=\"/resources/151711561881261.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151711561881261.png\" height=\"%\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>运行之后，查看SharedAssemblyInfo.cs的内容，发现版本号已经发生了改变：</p>\r\n<p>\r\n<a href=\"/resources/151713020638169.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151713020638169.png\" height=\"%\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>好了，下面就可以使用msbuild来编译整个解决方案了，之后我们查看编译出来的程序集的版本号：</p>\r\n<p>\r\n\r\n<a href=\"/resources/151713277206966.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151713277206966.png\" height=\"%\" /></a><br/>\r\n\r\n</p>\r\n<p> </p>\r\n<p>版本号最后两位对应Jenkins上的build number和revision number（舍去最高位），这样做是方便查询每个版本所对应的代码变更信息：</p>\r\n<p>\r\n\r\n\r\n<a href=\"/resources/151713511414475.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151713511414475.png\" height=\"%\" /></a><br/>\r\n</p>\r\n\r\n\r\n','2016-07-04 03:21:50','2016-07-04 02:48:32','PUBLISHED',8,'peng',5,'HTML'),(40,'排序算法总结：一、基数排序','基数排序(Radix sort)是一种非比较型的整数排序算法，其原理是将整数按位数切割成不同的数字，然后按每个位数分别比较。\r\n基数排序也分为LSD（Least significant digital）和MSD（Most significant digital）两种方式，LSD的排序方式由键值的最右边开始，而MSD则相反，由键值的最左边开始。','<p>基数排序(Radix sort)是一种非比较型的整数排序算法，其原理是将整数按位数切割成不同的数字，然后按每个位数分别比较。<br clear=\"none\">基数排序也分为LSD（Least significant digital）和MSD（Most significant digital）两种方式，LSD的排序方式由键值的最右边开始，而MSD则相反，由键值的最左边开始。<br clear=\"none\"><br clear=\"none\">以LSD为例，假设原来有一串数值如下所示：<br clear=\"none\">　　73, 22, 93, 43, 55, 14, 28, 65, 39, 81</p>\r\n<p>　　首先根据个位数的数值，在走访数值时将它们分配至编号0到9的桶子中：<br clear=\"none\">　　0->NULL<br clear=\"none\">　　1->81->NULL<br clear=\"none\">　　2->22->NULL<br clear=\"none\">　　3->73->93->43->NULL<br clear=\"none\">　　4->14->NULL<br clear=\"none\">　　5->55->65->NULL<br clear=\"none\">　　6->NULL<br clear=\"none\">　　7->NULL<br clear=\"none\">　　8->28->NULL<br clear=\"none\">　　9->39->NULL</p>\r\n<p>　　接下来将这些桶中的数值重新串接起来，成为以下的数列：<br clear=\"none\">　　81, 22, 73, 93, 43, 14, 55, 65, 28, 39</p>\r\n<p>　　接着再进行一次分配，这次是根据十位数来分配：<br clear=\"none\">　　0->NULL<br clear=\"none\">　　1->14->NULL<br clear=\"none\">　　2->22->28->NULL<br clear=\"none\">　　3->39->NULL<br clear=\"none\">　　4->43->NULL<br clear=\"none\">　　5->55->NULL<br clear=\"none\">　　6->65->NULL<br clear=\"none\">　　7->73->NULL<br clear=\"none\">　　8->81->NULL<br clear=\"none\">　　9->93->NULL</p>\r\n<p>　　接下来将这些桶中的数值重新串接起来，成为以下的数列：<br clear=\"none\">　　14, 22, 28, 39, 43, 55, 65, 73, 81, 93</p>\r\n<p>　　这时候整个数列已经排序完毕；如果排序的对象有三位数以上，则持续进行以上的动作直至最高位数为止。</p>\r\n<p>可以看到，我们使用了单链表来实现向桶中添加数组元素的功能，下面是具体的c语言实现：</p>\r\n<p>单链表头文件定义：</p>\r\n<p> </p>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c\">\r\n#ifndef _List_H\r\n#define _List_H\r\n \r\nstruct Node;\r\ntypedef int ElementType;\r\ntypedef struct Node* PtrToNode;\r\ntypedef PtrToNode List;\r\ntypedef PtrToNode Position;\r\n \r\nList MakeEmpty(List L);\r\nint IsEmpty(List L);\r\nint IsLast(Position P, List L);\r\nPosition Find(ElementType X, List L);\r\nPosition FindLast(List L);\r\nvoid Delete(ElementType X, List L);\r\nPosition FindPrevious(ElementType X, List L);\r\nvoid Insert(ElementType X, List L, Position P);\r\nvoid Append(ElementType X, List L);\r\nvoid DeleteList(List L);\r\nPosition Header(List L);\r\nPosition First(List L);\r\nPosition Advance(Position P);\r\nElementType Retrieve(Position P);\r\n \r\n#endif\r\n \r\nstruct Node\r\n{\r\n    ElementType Element;\r\n    Position Next;\r\n};\r\n</script>\r\n\r\n<p>单链表的实现：</p>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c\">\r\n#include \"List.h\"\r\n#include <stdio.h>\r\n#include <stdlib.h>\r\n \r\nvoid FatalError(char* c);\r\n \r\n//测试链表是否为空（只有一个头指针）\r\n//时间复杂度为O(1)\r\nint IsEmpty(List L)\r\n{\r\n    return L->Next == NULL;\r\n}\r\n \r\n//测试当前位置是否是链表的末尾\r\n//时间复杂度为O(1)\r\nint IsLast(Position P, List L)\r\n{\r\n    return P->Next == NULL;\r\n}\r\n \r\n//寻找链表L中节点值为X的位置\r\n//时间复杂度为O(N)\r\nPosition Find(ElementType X, List L)\r\n{\r\n    Position P;\r\n \r\n    P = L->Next;\r\n    while(P != NULL && P->Element != X)\r\n    {\r\n    P = P->Next;\r\n    }\r\n \r\n    return P;\r\n}\r\n \r\n//寻找并返回节点值为X的前置节点的位置\r\n//时间复杂度为O(N)\r\nPosition FindPrevious(ElementType X, List L)\r\n{\r\n    Position P;\r\n \r\n    P = L;\r\n    while(P->Next != NULL && P->Next->Element != X)\r\n    {\r\n    P = P->Next;\r\n    }\r\n    return P;\r\n}\r\n \r\n//寻找链表中最后一个节点的位置\r\n//时间复杂度为O(N)\r\nPosition FindLast(List L)\r\n{\r\n    Position P;\r\n \r\n    P = L;\r\n    while(P->Next != NULL)\r\n    {\r\n    P = P->Next;\r\n    }\r\n    return P;\r\n}\r\n \r\n//在链表L中删除节点值为X的节点\r\n//时间复杂度为O(N)\r\nvoid Delete(ElementType X, List L)\r\n{\r\n    Position P, TmpCell;\r\n \r\n    P = FindPrevious(X, L);\r\n \r\n    if(!IsLast(P, L))\r\n    {\r\n    TmpCell = P->Next;\r\n    P->Next = TmpCell->Next;\r\n    free(TmpCell);\r\n    }\r\n}\r\n \r\n//在单链表L中，将节点X插入到位置P的后面\r\n//时间复杂度为O(1)\r\nvoid Insert(ElementType X, List L, Position P)\r\n{\r\n    Position TmpCell;\r\n \r\n    TmpCell = malloc(sizeof(struct Node));\r\n    if(TmpCell == NULL)\r\n    {\r\n    FatalError(\"Out of space!!\");\r\n    return;\r\n    }\r\n \r\n    TmpCell->Element = X;\r\n    TmpCell->Next = P->Next;\r\n    P->Next = TmpCell;\r\n}\r\n \r\n//将节点插入到链表最后面的位置\r\n//时间复杂度为O(N)\r\nvoid Append(ElementType X, List L)\r\n{\r\n    Insert(X, L, FindLast(L));\r\n}\r\n \r\n//删除全部链表，只留下头节点。\r\n//时间复杂度为O(N)\r\nvoid DeleteList(List L)\r\n{\r\n    Position P, temp;\r\n \r\n    P = L->Next;\r\n    L->Next = NULL;\r\n \r\n    while(P != NULL)\r\n    {\r\n    temp = P->Next;\r\n    free(P);\r\n    P = temp;\r\n    }\r\n}\r\n \r\nvoid FatalError(char* c)\r\n{\r\n    printf(\"Fatal Error: %s\\n\", c);\r\n}\r\n</script>\r\n<br/>\r\n<p>基数排序算法的实现：</p>\r\n<script type=\"syntaxhighlighter\" class=\"brush: c\">\r\n#include <stdio.h>\r\n#include <stdlib.h>\r\n#include \"List.h\"\r\n \r\n#define sizeOfArray 10\r\n \r\nint* RadixSort(int*, int, int);\r\nvoid PrintAll(int*, int );\r\nvoid RebuildListHeaderArray(PtrToNode*, int );\r\n \r\nint main(void)\r\n{\r\n    int inputData[] = {73, 22, 393, 43, 255, 14, 28, 65, 39, 181};\r\n    int *newInputData;\r\n \r\n    printf(\"Initial:\\n\");\r\n    PrintAll(inputData, sizeOfArray);\r\n \r\n    newInputData = RadixSort(inputData, sizeOfArray, 3);\r\n \r\n    printf(\"Final:\\n\");\r\n    PrintAll(newInputData, sizeOfArray);\r\n \r\n    return 1;\r\n}\r\n \r\n//基数排序的时间复杂度是 O(k·n)，其中n是排序元素个数，k是数字位数。\r\nint* RadixSort(int inputData[], int arrayLength, int digitLength)\r\n{\r\n    int i, j, k, div; \r\n    PtrToNode headerArray[arrayLength];\r\n \r\n    //Initialize\r\n    for(i=0; i<arrayLength; i++)\r\n    {\r\n    //Make a header first\r\n    PtrToNode header = malloc(sizeof(struct Node));\r\n    header->Element = i;\r\n    header->Next = NULL;\r\n \r\n    headerArray[i] = header;\r\n    }\r\n \r\n    //Insert List\r\n    for(i=0, div=1; i<digitLength; i++, div=div*10)\r\n    {\r\n    for(j=0; j<arrayLength; j++)\r\n    {\r\n        //Fetch a header first\r\n        PtrToNode header = headerArray[inputData[j] / div % 10];\r\n \r\n        //Insert into list\r\n        Append(inputData[j], header);\r\n    }\r\n \r\n    //Regenerate array\r\n    int index = 0;\r\n    for(k=0; k<arrayLength; k++)\r\n    {\r\n        Position p = headerArray[k];\r\n        while(p->Next != NULL)\r\n        {\r\n        p = p->Next;\r\n        inputData[index] = p->Element;\r\n        index++;\r\n        }\r\n    }\r\n    printf(\"The %d pass result:\\n\", i+1);\r\n    PrintAll(inputData, 10);\r\n    RebuildListHeaderArray(headerArray, 10);\r\n    }\r\n    return inputData;\r\n}\r\n \r\nvoid PrintAll(int *p, int arrayLength)\r\n{\r\n    int i;\r\n    for(i=0; i<arrayLength; i++)\r\n    {\r\n    printf(\"%d, \", *(p+i));\r\n    }\r\n    printf(\"\\n\");\r\n}\r\n \r\nvoid RebuildListHeaderArray(PtrToNode headerArray[], int arrayLength)\r\n{\r\n    int i;\r\n    for(i=0; i<arrayLength; i++)\r\n    {\r\n    DeleteList(headerArray[i]);\r\n    }\r\n}\r\n</script>\r\n\r\n<p>输出结果如下：<br clear=\"none\">Initial:<br clear=\"none\">73, 22, 393, 43, 255, 14, 28, 65, 39, 181,</p>\r\n<p>The 1 pass result:<br clear=\"none\">(按个位数排序)<br clear=\"none\">181, 22, 73, 393, 43, 14, 255, 65, 28, 39,</p>\r\n<p>The 2 pass result:<br clear=\"none\">（按十位数排序）<br clear=\"none\">14, 22, 28, 39, 43, 255, 65, 73, 181, 393,</p>\r\n<p>The 3 pass result:<br clear=\"none\">（按百位数排序）<br clear=\"none\">14, 22, 28, 39, 43, 65, 73, 181, 255, 393,</p>\r\n<p>Final:<br clear=\"none\">14, 22, 28, 39, 43, 65, 73, 181, 255, 393,</p>\r\n<p>可以看到在经过三趟排序后，算法结束。时间复杂度是O(digitLength*arrayLength), 也就是算法所用时间与输入元素中的最高位数与输入的元素数的乘积成正比。</p>','2016-07-04 06:03:00','2016-07-04 03:53:04','PUBLISHED',6,'peng',13,'HTML'),(41,'排序算法总结：二、插入排序','排序算法总结：二、插入排序','<p>先说一下比较排序的定义吧：</p>\r\n<h3><strong>比较排序的定义</strong></h3>\r\n<p>就是除了赋值操作外, 只存在小于‘<’和大于‘>’这两种运算符是仅有的允许对<br clear=\"none\">输入数据进行的操作。</p>\r\n<h3><strong>插入排序的性质</strong></h3>\r\n<ul class=\" list-paddingleft-2\">\r\n<ul class=\" list-paddingleft-2\">\r\n<li>插入排序是一种比较排序</li>\r\n<li>将一个数组分为两部分,前面为排好序的部分,后面为未排序的部分</li>\r\n<li>将未排序部分的元素逐个插入到已排好序部分的正确位置上</li>\r\n<li>就像扑克牌按顺序排列,原先 2,4,5 和 10 都排好序了,现在需要为 7 找到正确的位置</li>\r\n\r\n\r\n</ul>\r\n\r\n\r\n</ul>\r\n<p> </p>\r\n<h3><strong>时间复杂度</strong></h3>\r\n<ul class=\" list-paddingleft-2\">\r\n<li>运行时间为 T(N) = O(N^2)</li>\r\n<li>平均运行时间为 T(N) = Θ(N^2)。</li>\r\n\r\n\r\n</ul>\r\n<h3>代码实现</h3>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c\">\r\n#include \r\n \r\ntypedef int ElementType;\r\nvoid InsertionSort(ElementType A[], int N);\r\n \r\nvoid main(void)\r\n{\r\n    int i;\r\n    int unordered[] = {4, 5, 2, 1, 0};\r\n    InsertionSort(unordered, 5);\r\n    for(i = 0; i < 5; i++)\r\n    {\r\n        printf(\"%d\\n\", unordered[i]);\r\n    }\r\n}\r\n \r\n//双重循环，时间复杂度为T(N)=O(N^2)\r\nvoid InsertionSort(ElementType A[], int N)\r\n{\r\n    int j, p;\r\n \r\n    ElementType Tmp;\r\n    for(p = 1; p < N; p++)\r\n    {\r\n        Tmp = A[p];\r\n        for(j = p; j > 0 && A[j - 1] > Tmp; j--)\r\n        {\r\n            A[j] = A[j - 1];\r\n        }\r\n        A[j] = Tmp;\r\n    }\r\n}\r\n</script>\r\n\r\n<p> </p>\r\n<h3>排序过程演示</h3>\r\n<p>排序数组 5, 2, 4, 6, 1, 3 的过程:</p>\r\n<p>\r\n<a href=\"/resources/151725587988407.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151725587988407.png\" height=\"%\" /></a><br/>\r\n\r\n</p>\r\n','2016-07-04 06:08:04','2016-07-04 06:07:11','PUBLISHED',3,'peng',13,'HTML'),(42,'在CentOS 5.8上搭建PPTP VPN服务','在天朝上网，vpn已经是必备之物了，我也记录一下搭建vpn服务的方法','<p>在天朝上网，vpn已经是必备之物了，我也记录一下搭建vpn服务的方法。</p>\r\n<p>1. 确认内核是否支持MPPE模块<br clear=\"none\">MPPE用来支持Microsoft Point to Point Encryption， 包括微软和Linux桌面都支持MPPE</p>\r\n<pre class=\"brush: bash\">modprobe ppp-compress-18 && echo ok</pre>\r\n<p> <br clear=\"none\">2. 安装ppp软件包<br clear=\"none\">pptp是使用ppp协议对数据进行封装的，然后将ppp数据帧封装在ip数据报文中。</p>\r\n<pre class=\"brush: bash\">yum install ppp</pre>\r\n<p> <br clear=\"none\">3. 安装pptp软件包<br clear=\"none\">下载32位rpm包：</p>\r\n<pre class=\"brush: bash\">wget http://poptop.sourceforge.net/yum/stable/packages/pptpd-1.3.4-2.rhel5.i386.rpm</pre>\r\n<p>安装:</p>\r\n<pre class=\"brush: bash\">rpm -ivh pptpd-1.3.4-2.rhel5.i386.rpm</pre>\r\n<p> </p>\r\n<p>4. 配置pptp</p>\r\n<pre class=\"brush: bash\">vim /etc/ppp/options.pptpd</pre>\r\n<p>将以下配置项打开：</p>\r\n<pre class=\"brush: bash\">\r\nname pptpd\r\nrefuse-pap\r\nrefuse-chap\r\nrefuse-mschap\r\nrequire-mschap-v2\r\nrequire-mppe-128\r\nms-dns 8.8.8.8\r\nms-dns 8.8.4.4\r\nproxyarp\r\nlock\r\nnobsdcomp\r\nnovj\r\nnovjccomp\r\nnologfd</pre>\r\n<p>配置localip和remoteip：</p>\r\n<pre class=\"brush: bash\">vim /etc/pptpd.conf</pre>\r\n<pre class=\"brush: bash\">option /etc/ppp/options.pptpd\r\nlogwtmp\r\nlocalip 192.168.0.1\r\nremoteip 192.168.0.207-217</pre>\r\n<p>VPN可以这样理解，Linux客户端使用一个虚拟网络设备ppp0（Windows客户端也可以理解成VPN虚拟网卡），连接到服务器的虚拟网络设备ppp0上，这样客户端就加入了服务器端ppp0所在的网络。localip就是可以分配给服务器端ppp0的IP地址，remoteip则是将要分配给客户端ppp0（或者虚拟网卡）的。<br clear=\"none\">这两项都可以是多个IP，一般localip设置一个IP就行了，remoteip则视客户端数目，分配一段IP。其中remoteip的IP段需要和localip的IP段一致。<br clear=\"none\">localip和remoteip所处的IP段可以随意些指定，但其范围内不要包含实际网卡eth0的IP地址。<br clear=\"none\"> <br clear=\"none\">5. 配置帐号</p>\r\n<pre  class=\"brush: bash\">\r\nvim /etc/ppp/chap-secrets\r\n</pre>\r\n\r\n<p>这个文件非常简单，其中用明文存储VPN客户的用户名、服务名称、密码和IP地址范围，每行一个账户：</p>\r\n\r\n<pre  class=\"brush: bash\">\r\nusername1    pptpd    passwd1    *\r\nusername2    pptpd    passwd2    *\r\n</pre>\r\n\r\n<p> <br clear=\"none\">6. 打开内核的IP转发功能</p>\r\n\r\n<pre  class=\"brush: bash\">\r\nvim /etc/sysctl.conf\r\n</pre>\r\n\r\n<p>修改net.ipv4.ip_forward为1</p>\r\n<pre class=\"brush: bash\">net.ipv4.ip_forward = 1</pre>\r\n<p>使修改生效：</p>\r\n<pre  class=\"brush: bash\">sysctl -p</pre>\r\n<p> <br clear=\"none\">7. 启动服务，并开机自动启动</p>\r\n<pre  class=\"brush: bash\">\r\n\r\n/etc/init.d/pptpd start\r\nchkconfig --level 35 pptpd on\r\n</pre>\r\n\r\n<p>\r\n<br clear=\"none\">\r\n8. 配置路由支持vpn的转发执行下面的命令：\r\n</p>\r\n<pre  class=\"brush: bash\">\r\niptables -A INPUT -p gre -j ACCEPT\r\niptables -A INPUT -p tcp -m tcp --dport 1723 -j ACCEPT\r\niptables -A FORWARD -s 192.168.0.0/24 -o eth0 -j ACCEPT\r\niptables -A FORWARD -d 192.168.0.0/24 -i eth0 -j ACCEPT\r\niptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE\r\n</pre>\r\n<p>保存下路由信息：</p>\r\n\r\n<pre  class=\"brush: bash\">\r\n/etc/init.d/iptables save\r\n</pre>\r\n\r\n<p>好了，现在可以在客户端连接搭建好的VPNFQ喽</p>','2016-07-04 06:18:37','2016-07-04 06:10:43','PUBLISHED',3,'peng',11,'HTML'),(43,'C语言的struct/union字节对齐','C语言的一大优势就是对内存空间的控制，当然，一般情况下对于开发人员来说都是透明的。看一个始终困扰初学者的问题：字节对齐！','<p>C语言的一大优势就是对内存空间的控制，当然，一般情况下对于开发人员来说都是透明的。看一个始终困扰初学者的问题：字节对齐！</p>\r\n<p><strong>先看四个重要的基本概念：</strong><br clear=\"none\">1.数据类型自身的对齐值：<br clear=\"none\">对于char型数据，其自身对齐值为1，对于short型为2，对于int,float,double类型，其自身对齐值为4，单位字节。</p>\r\n<p>2.结构体或者类的自身对齐值：<br clear=\"none\">其成员中自身对齐值最大的那个值。</p>\r\n<p>3.指定对齐值：<br clear=\"none\">#pragma pack (value)时的指定对齐值value。</p>\r\n<p>4.数据成员、结构体和类的有效对齐值：<br clear=\"none\">自身对齐值和指定对齐值中小的那个值。</p>\r\n<p><br clear=\"none\"><strong>有效对齐值N是最终用来决定数据存放地址方式的值，最重要。有效对齐N，就是 表示“对齐在N上”，也就是说该数据的”存放起始地址%N=0“.<br clear=\"none\">而数据结构中的数据变量都是按定义的先后顺序来排放的。第一个数据变量的起始地址就是数据结构的起始地址。结构体的成员变量要对齐排放。</strong></p>\r\n<p>分析一下下面这段代码：</p>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c\">\r\nstruct stExample  \r\n{  \r\n    char    a;  \r\n    int     b;  \r\n    short   c;  \r\n}; \r\nsizeof( char ) == 1  \r\nsizeof( short ) == 2  \r\nsizeof( int ) == 4  \r\n \r\nsizeof( struct stExample ) == 12\r\n</script>\r\n<p>stExample结构体占据12 Byte</p>\r\n<p>假设stExample从地址空间0×0000开始排放。该例子中没有定义指定对齐值，在笔者环境下，该值默认为4。三个成员的存储位置如图：</p>\r\n<p>\r\n<a href=\"/resources/151728347516562.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151728347516562.png\" height=\"%\" /></a><br/>\r\n\r\n</p>\r\n<p>1. 第一个成员变量a的自身对齐值是1，比指定或者默认指定 对齐值4小，所以其有效对齐值为1，所以其存放地址0×0000符合0×0000%1=0.</p>\r\n<p>2. 第二个成员变量b，其自身对齐值为4，所以有效对齐值也为4， 所以只能存放在起始地址为0×0004到0×0007这四个连续的字节空间中，复核0×0004%4=0,且紧靠第一个变量。</p>\r\n<p>3. 第三个变量c,自身对齐值为 2，所以有效对齐值也是2，可以存放在0×0008到0×0009这两个字节空间中，符合0×0008%2=0。</p>\r\n<p>所以从0×0000到0×0009存放的 都是stExample内容。再看数据结构stExample的自身对齐值为其变量中最大对齐值(这里是b）所以就是4，所以结构体的有效对齐值也是4。根据结构体圆整的要求， 0×0009到0×0000=10字节，（10＋2）％4＝0。所以0x0000A到0x000B也为结构体stExample所占用。故stExample从0×0000到0x000B 共有12个字节,sizeof( struct stExample )=12.</p>\r\n<p>其实如果就这一个就来说它已将满足字节对齐了, 因为它的起始地址是0,因此肯定是对齐的,之所以在后面补充2个字节,是因为编译器为了实现结构数组的存取效率。</p>\r\n<p><strong>试想如果我们定义了一个结构体stExample的数组,那么第一个结构起始地址是0没有问题,但是第二个结构呢?按照数组的定义,数组中所有元素都是紧挨着的,如果我们不把结构的大小补充为4的整数倍,那么下一个结构的起始地址将是0x0000A,这显然不能满足结构的地址对齐了(因为如果以0x0000A最为起始地址，0x0000A%4 != 0, 不能作为结构体起始地址。),因此我们要把结构补充成有效对齐大小的整数倍.</strong></p>\r\n<p>其实诸如:对于char型数据，其自身对齐值为1，short类型为2，int,float,double类型，其自身对齐值为4，这些已有类型的自身对齐值也是基于数组考虑的,只是因为这些类型的长度已知了,所以他们的自身对齐值也就已知了.</p>\r\n<p><strong>union 共用体的字节对齐情况类似，共用体的自身对齐值决定于成员的最大自身对齐值。</strong></p>\r\n','2016-07-04 06:25:39','2016-07-04 06:23:23','PUBLISHED',5,'peng',14,'HTML'),(44,'删除单链表中的节点','删除单链表中的节点','<p>最近看到Linus在采访中提到一种删除单链表中节点的方法，并说不懂这种方法的人都不理解指针，原话如下：</p>\r\n\r\n<p>At the opposite end of the spectrum, I actually wish more people understood the really core low-level kind of coding. Not big, complex stuff like the lockless name lookup, but simply good use of pointers-to-pointers etc. For example, I’ve seen too many people who delete a singly-linked list entry by keeping track of the “prev” entry, and then to delete the entry, doing something like</p>\r\n\r\n<p>if (prev)<br clear=\"none\">prev->next = entry->next;<br clear=\"none\">else<br clear=\"none\">list_head = entry->next;</p>\r\n\r\n<p>and whenever I see code like that, I just go “This person doesn’t understand pointers”. And it’s sadly quite common.</p>\r\n\r\n<p><br clear=\"none\">People who understand pointers just use a “pointer to the entry pointer”, and initialize that with the address of the list_head. And then as they traverse the list, they can remove the entry without using any conditionals, by just doing a “*pp = entry->next”.</p>\r\n\r\n<p>So there’s lots of pride in doing the small details right. It may not be big and important code, but I do like seeing code where people really thought about the details, and clearly also were thinking about the compiler being able to generate efficient code (rather than hoping that the compiler is so smart that it can make efficient code *despite* the state of the original source code).</p>\r\n\r\n<p>其实大神说的这种方法的好处就是: 在删除节点时，不用区别该节点是否是链表的第一个节点，具体实现代码如下：</p>\r\n\r\n<script type=\"syntaxhighlighter\" class=\"brush: c\">\r\n//定义最简单的链表结构\r\ntypedef struct node\r\n{\r\n    int value;\r\n    struct node* next;\r\n}Node;\r\n \r\nNode** pp = &list_head;\r\nNode* entry = list_head;\r\n \r\n//假设要删除的节点值是9\r\nwhile(entry->value != 9)\r\n{\r\n    //每次迭代都将next变量的地址保存到pp中\r\n    //next是指针变量，故它的地址就是地址的地址了，即Node**\r\n    pp = &entry->next;\r\n    entry = entry->next;\r\n}\r\n \r\n//将前置节点的next值指向下一个节点\r\n*pp = entry->next;\r\n</script>\r\n\r\n\r\n<p>各变量内容的变化如下：</p>\r\n<pre>内存地址：0x1               0x2                       0x4              0x8\r\n        list_head=0x2     node1(value:10,           node2(value:9,   node3(value:8)\r\n                                next变量的内存地址：\r\n                                0x3                       0x5              0x9\r\n                                next:0x4)                 next:0x8         next:NULL\r\n&nbsp;\r\n迭代过程：\r\npp=0x1\r\nentry=0x2\r\n&nbsp;\r\npp=0x3\r\nentry=0x4\r\n&nbsp;\r\n查找到要删除的节点：\r\n*pp=0x8 =&gt; 0x2            \r\n           node1(value:10,\r\n                 0x3      \r\n                 next:0x4 =&gt; 0x8)<br><br>这样，无论需要删除的是node1（头节点）还是普通节点，都不需要判断前置节点是否为头节点的指针。</pre>','2016-07-04 06:54:06','2016-07-04 06:30:54','PUBLISHED',4,'peng',14,'HTML'),(45,'集成Jenkins Notifier for Chrome到Jenkins CI','Jenkins也算是现在最流行的CI工具了，我们team也使用它来做持续化集成的工作。最近需要增加弹出式窗口来提醒相关人员job的状态，故选择Jenkins Notifier for Chrome这个Chrome浏览器的plugin来实现，而且我们team内部也都使用Chrome浏览器。具体安装方法如下','<p>Jenkins也算是现在最流行的CI工具了，我们team也使用它来做持续化集成的工作。最近需要增加弹出式窗口来提醒相关人员job的状态，故选择Jenkins Notifier for Chrome这个Chrome浏览器的plugin来实现，而且我们team内部也都使用Chrome浏览器。具体安装方法如下：</p>\r\n<p><br clear=\"none\">1. CI server端首先需要安装Jenkins Websocket plugin，之后配置Websocket的端口，打开Manege Jenkins > Configure System > Websocket Notifier，输入端口号：</p>\r\n<p>\r\n<a href=\"/resources/151732372042825.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151732372042825.png\" height=\"%\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>2. 将想要支持Notifier的job选中Websocket Notifier：</p>\r\n<p><a href=\"/resources/151733026412219.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151733026412219.png\" height=\"%\" /></a><br/></p>\r\n<p> </p>\r\n<p>3. 安装chrome插件Jenkins Notifier：</p>\r\n<p><a href=\"/resources/151734137666723.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151734137666723.png\" height=\"%\" /></a><br/></p>\r\n<p> </p>\r\n<p>4. 配置Jenkins Notifier插件：</p>\r\n<p>\r\n<a href=\"/resources/151734477359112.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151734477359112.png\" height=\"%\" /></a><br/>\r\n</p>\r\n<p> </p>\r\n<p>Jenkins URL就填<a href=\"http://172.16.20.8:8080/\" shape=\"rect\" target=\"_blank\">http://172.16.20.8:8080</a></p>\r\n<p>Websocket就填ws://<a href=\"http://172.16.20.8:8081/Jenkins\" shape=\"rect\" target=\"_blank\">172.16.20.8:8081/Jenkins</a></p>\r\n<p>Job Name是想要被通知的Job名字，也就是<a href=\"http://172.16.20.8:8080/\" shape=\"rect\" target=\"_blank\">http://172.16.20.8:8080/</a>里面Name列的名字，</p>\r\n<p>点击save就成了。</p>\r\n<p>之后这个Job完成后，就会有通知窗口弹出了：</p>\r\n<p><a href=\"/resources/151735145953208.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151735145953208.png\" height=\"%\" /></a><br/></p>\r\n<p> </p>\r\n<p>问题来了，这个chrome插件只能支持一个Job的状态通知，如果我们想要同时监控多个Job，就要做些chrome extension 的工作了，方法如下：</p>\r\n<p>1. Chrome的扩展程序可以重复添加到其中，我们重复添加这个Jenkins Notifier插件，并配置他们分别监控不同job的状态。首先，找到已经安装extension的安装路径，默认是安装在这里：</p>\r\n<p>C:\\Users\\[UserName]\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Extensions\\mnjbjjllbclkpnebaddhkoonjelmiekm\\0.3_0</p>\r\n<p>(这个key ”mnjbjjllbclkpnebaddhkoonjelmiekm“ 肯定不可能跟我一样）</p>\r\n<p><a href=\"/resources/151735389238275.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151735389238275.png\" height=\"%\" /></a><br/></p>\r\n<p>2. copy 这个目录的所有文件到一个目录下，我们起名为JenkinsNotifier</p>\r\n<p>3. Chrome中打开<a shape=\"rect\">chrome://chrome/extensions/</a>， 选中开发人员模式：</p>\r\n<p><a href=\"/resources/151736287201196.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151736287201196.png\" height=\"%\" /></a><br/></p>\r\n<p>4. 点击“打包扩展程序”， 选中JenkinsNotifier目录：</p>\r\n<p><a href=\"/resources/151737116574577.jpg\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151737116574577.jpg\" height=\"%\" /></a><br/></p>\r\n<p> </p>\r\n<p>5. 点击“打包扩展程序”：</p>\r\n<p><a href=\"/resources/151737516737919.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151737516737919.png\" height=\"%\" /></a><br/></p>\r\n<p> </p>\r\n<p>打包完成：</p>\r\n<p><a href=\"/resources/151738168135871.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151738168135871.png\" height=\"%\" /></a><br/></p>\r\n<p> </p>\r\n<p>6. 将生成的E:\\JenkinsNotifier.crx拖到chrome中安装：</p>\r\n<p><a href=\"/resources/151738501107632.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151738501107632.png\" height=\"%\" /></a><br/></p>\r\n<p><a href=\"/resources/151738555487172.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151738555487172.png\" height=\"%\" /></a><br/></p>\r\n<p> </p>\r\n<p>7. 多次重复上面的步骤，可以添加多个JenkinsNotifier，并分别配置他们来监控不同job的状态：</p>\r\n<p><a href=\"/resources/151739261576420.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/151739261576420.png\" height=\"%\" /></a><br/></p>\r\n<p>搞定！</p>\r\n<p> </p>','2016-07-04 07:55:17','2016-07-04 07:15:27','PUBLISHED',7,'peng',5,'HTML'),(46,'Mac生存手册','最近刚从Linux转到了Mac系统上，感觉好的地方是再也不折腾了，什么GNOME， KDE， XFCE，各种发行版本都远离我而去了。当然Mac下很多好软件都是要付费的，我只能绕着走了','<p>最近刚从Linux转到了Mac系统上，感觉好的地方是再也不折腾了，什么GNOME， KDE， XFCE，各种发行版本都远离我而去了。当然Mac下很多好软件都是要付费的，我只能绕着走了：</p>\r\n<p>1. 命令行，我使用iTerm，比默认的terminal好用的多</p>\r\n<p>2. 编辑器，命令行里面用vim，UI用sublime text</p>\r\n<p>3. IDE， Python用的是sublime text和Pycharm， 稍微上点规模的项目不用IDE真是作死啊。 Java用的IntelliJ IDEA社区免费版，感觉比Eclipse要流畅的多 :)</p>\r\n<p>4. 词典用的有道词典，其它的不知道也没用过，感觉比Linux下得那个stardic好用不少，废话啊。。</p>\r\n<p>5. 通讯软件，QQ，微信，Skype都用，终于不用在Linux下用webqq喽</p>\r\n<p>6. 浏览器，还是用默认的Safari了，加上各种extension还不错，最常用的是防止播放flash发热的“MAMA2”插件了，能把flash转换为html5播放，防止macbook热的能烤猪。还有就是evernote的“clip to evernote”插件。</p>\r\n<p>7. 下载软件，平时小东西都用wget，大点的只能求助于迅雷了</p>\r\n<p>8. Office，装了MS office，没办法，其他的还是差点，linux下用过wps，算是linux下最好用的了。</p>\r\n<p>9. 虚拟机，使用的免费得virtualbox，付费的算了。。反正用的很少</p>\r\n<p>10. 卸载软件，使用的AppCleaner，它能搜索你想卸载的软件的相关位置，还是很不错的</p>\r\n<p>11. 远程登录，登陆家里的windows电脑我用的是“Remote Desktop Connection”， 非本地局域网我用的是TeamViewer</p>\r\n<p>12. 文件浏览器，我装了XtraFinder，终于Finder变得可以用用了，不过和TotalCommander比不了</p>\r\n<p>13. 还有白噪音的一个好软件叫“Noizio”，笔记用的Evernote和系统带的Notes，视频播放器用的MPlayerX。</p>\r\n<p>&nbsp;</p>\r\n<p>好了，就这么多了，基本上能用系统自带的就用自带的了。</p>','2016-07-04 08:36:15','2016-07-04 08:36:15','PUBLISHED',2,'peng',12,'HTML'),(47,'Mac下的UI自动化测试 （一）','在我看来，实现UI自动化测试的过程一向都是令人快乐的事情，而维护它们就是跟噩梦一样了，尤其是对每次CI产生的build进行BVT测试，由于开发不会告诉你任何UI的变化，那么你拿到的测试结果就势必会一片红了。但是对于界面相对稳定的项目，有大量回归测试需要进行的项目，实现UI自动化的投资回报率还是很高的。','<p>在我看来，实现UI自动化测试的过程一向都是令人快乐的事情，而维护它们就是跟噩梦一样了，尤其是对每次CI产生的build进行BVT测试，由于开发不会告诉你任何UI的变化，那么你拿到的测试结果就势必会一片红了。但是对于界面相对稳定的项目，有大量回归测试需要进行的项目，实现UI自动化的投资回报率还是很高的。</p>\r\n<p>最近我实现了公司一个产品在Mac OSX上的UI自动化测试，下面就把具体的细节写出来。</p>\r\n<p>首先，选用的是由 MIT 研究团队发布的图形化编程技术 Sikuli，它以图像检索为基础，提供了一套基于 Jython 的脚本语言以及集成开发环境，使用者可利用屏幕截图直接引用 GUI 元素进行编程，完成交互操作。</p>\r\n<p>所有的按钮操作和拖动操作都是用Sikuli来完成的，而像窗口的相关操作，比如非全屏最大化，控制Finder定位到一个路径等等操作都是用AppleScript实现的，因为用图像识别去操作一些很小的或者是与周围图像没有明显区别的控件时，使用Sikuli还是不稳定的。</p>\r\n<p>Sikuli不光提供了类库，还提供了一个IDE， 当然其功能很简单，而且经常crash，所以建议还是能不用就不用它吧。</p>\r\n<p>还有就是由于Sikuli提供的是一套java包，然后再使用Jython进行包装，让其语言更加简单，但是这就有可能导致你想用的python库不能与jython兼容。</p>\r\n<p> </p>\r\n<h3>环境准备：</h3>\r\n<p>1. 安装Java SDK</p>\r\n<p>2. 下载Sikuli， 访问<a href=\"http://www.sikuli.org\" target=\"_blank\">官网</a>下载jar包即可</p>\r\n<p>3. 安装Sikuli， 双击\'sikulixsetup-1.1.0.jar\'， 勾选1， 2即可 （Sikuli的安装界面，左右一个开源项目来说，已经是很出色了）</p>\r\n<p><a href=\"/resources/152237022987069.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/152237022987069.png\" /></a><br/></p>\r\n<p> </p>\r\n<p>4. 安装过后，会生成一个app文件，建议将其拖到Application中吧：</p>\r\n<p><a href=\"/resources/152238579077682.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/152238579077682.png\"  /></a><br/></p>\r\n<p>5. 最后执行SikuliX.app即可</p>\r\n<p>到此，安装就结束了，打开即可开到Sikuli的IDE了：</p>\r\n<p><a href=\"/resources/152243482666709.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/152243482666709.png\" height=\"50%\" /></a><br/></p>\r\n<p>可以使用它方便进行截图和调整图片的匹配度。</p>\r\n<p> </p>\r\n<p>6. 由于使用的是图像识别，所以最好在开发和运行阶段都将OSX的透明度关掉，以免干扰图像识别的准确度。</p>\r\n<p>    在System Preferences中关掉透明：</p>\r\n<p><a href=\"/resources/160002005951778.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/160002005951778.png\"  /></a><br/></p>\r\n<p> </p>\r\n<p>7. 将需要用到的app加入到“Security & Privacy”的“Accessibility”中：</p>\r\n<p><a href=\"/resources/160002369237779.png\" data-lightbox=\"image-1\"    data-title=\"\"><img src=\"/resources/160002369237779.png\"  height=\"50%\" /></a><br/></p>\r\n<p> </p>\r\n<p>到此，环境准备的差不多了，当然如果需要用到python的相关模块， 可以安装get-pip.py，之后执行install命令了：</p>\r\n<p>　　<em>sudo pip install [module name]</em></p>\r\n<p> </p>','2016-07-05 03:13:47','2016-07-04 09:08:55','PUBLISHED',0,'peng',6,'HTML');
/*!40000 ALTER TABLE `blog` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `blog_tag`
--

DROP TABLE IF EXISTS `blog_tag`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `blog_tag` (
  `blog_id` int(11) NOT NULL,
  `tag_id` int(11) NOT NULL,
  PRIMARY KEY (`blog_id`,`tag_id`),
  KEY `fk_blog_tag_2_idx` (`tag_id`),
  CONSTRAINT `fk_blog_tag_1` FOREIGN KEY (`blog_id`) REFERENCES `blog` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_blog_tag_2` FOREIGN KEY (`tag_id`) REFERENCES `tag` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `blog_tag`
--

LOCK TABLES `blog_tag` WRITE;
/*!40000 ALTER TABLE `blog_tag` DISABLE KEYS */;
INSERT INTO `blog_tag` VALUES (25,3),(28,3),(29,3),(31,3),(34,3),(35,3),(36,3),(42,3),(46,3),(20,6),(32,6),(38,6),(39,6),(45,6),(20,7),(21,8),(22,8),(33,9),(37,10),(38,10),(39,10),(40,11),(41,11),(43,12),(44,12),(47,13),(47,14),(47,15);
/*!40000 ALTER TABLE `blog_tag` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `book_recommendation`
--

DROP TABLE IF EXISTS `book_recommendation`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `book_recommendation` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `url` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `img_src` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `book_recommendation`
--

LOCK TABLES `book_recommendation` WRITE;
/*!40000 ALTER TABLE `book_recommendation` DISABLE KEYS */;
/*!40000 ALTER TABLE `book_recommendation` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `category`
--

DROP TABLE IF EXISTS `category`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `category` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `create_time` datetime NOT NULL,
  `update_time` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `category`
--

LOCK TABLES `category` WRITE;
/*!40000 ALTER TABLE `category` DISABLE KEYS */;
INSERT INTO `category` VALUES (5,'持续化集成','2016-06-15 03:21:20','2016-06-15 03:21:20'),(6,'自动化测试','2016-06-15 03:21:44','2016-06-15 03:21:44'),(10,'服务端测试','2016-06-18 08:41:02','2016-06-18 08:41:02'),(11,'Linux相关','2016-07-01 10:05:56','2016-07-01 10:05:56'),(12,'Others','2016-07-01 14:47:01','2016-07-01 14:47:01'),(13,'算法','2016-07-04 03:56:52','2016-07-04 03:56:52'),(14,'编程语言','2016-07-04 06:25:00','2016-07-04 06:25:00');
/*!40000 ALTER TABLE `category` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `comment`
--

DROP TABLE IF EXISTS `comment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `comment` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `content` text COLLATE utf8_unicode_ci NOT NULL,
  `comment_user_id` int(11) NOT NULL,
  `create_time` datetime NOT NULL,
  `blog_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_comment_1_idx` (`comment_user_id`),
  KEY `fk_comment_2_idx` (`blog_id`),
  CONSTRAINT `fk_comment_1` FOREIGN KEY (`comment_user_id`) REFERENCES `comment_user` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_comment_2` FOREIGN KEY (`blog_id`) REFERENCES `blog` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `comment`
--

LOCK TABLES `comment` WRITE;
/*!40000 ALTER TABLE `comment` DISABLE KEYS */;
/*!40000 ALTER TABLE `comment` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `comment_user`
--

DROP TABLE IF EXISTS `comment_user`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `comment_user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(45) COLLATE utf8_unicode_ci NOT NULL,
  `email` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `blog_url` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
  `remote_ip` varchar(45) COLLATE utf8_unicode_ci DEFAULT NULL,
  `update_time` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `comment_user`
--

LOCK TABLES `comment_user` WRITE;
/*!40000 ALTER TABLE `comment_user` DISABLE KEYS */;
INSERT INTO `comment_user` VALUES (1,'测试','liupeng@gmail.com','http://pengliu.cf','36.110.112.98','2016-06-29 08:08:44'),(2,'tester','sdfsdf@sfsdf.com','','36.110.112.98','2016-06-29 11:15:33'),(3,'test','test@test.com','http://www.test.com','127.0.0.1','2016-07-03 07:24:12'),(4,'test2','sdfsf@sf.com','http://www.sdf.com','127.0.0.1','2016-07-03 07:24:33');
/*!40000 ALTER TABLE `comment_user` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `friendly_link`
--

DROP TABLE IF EXISTS `friendly_link`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `friendly_link` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `url` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `display_name` varchar(45) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `friendly_link`
--

LOCK TABLES `friendly_link` WRITE;
/*!40000 ALTER TABLE `friendly_link` DISABLE KEYS */;
INSERT INTO `friendly_link` VALUES (1,'http://coolshell.cn/','酷 壳 – CoolShell.cn'),(2,'http://www.ahathinking.com/','勇幸|Thinking'),(3,'http://www.ruanyifeng.com/blog/','阮一峰的网络日志'),(4,'http://blog.zhaojie.me/','老赵点滴'),(5,'http://wangheng.org','王恒\'s Blog'),(6,'http://lihao.cf','豪哥的博客');
/*!40000 ALTER TABLE `friendly_link` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `tag`
--

DROP TABLE IF EXISTS `tag`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `tag` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(45) COLLATE utf8_unicode_ci NOT NULL,
  `create_time` datetime NOT NULL,
  `update_time` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `tag`
--

LOCK TABLES `tag` WRITE;
/*!40000 ALTER TABLE `tag` DISABLE KEYS */;
INSERT INTO `tag` VALUES (3,'Others','2016-06-15 07:42:41','2016-06-18 09:01:07'),(6,'Jenkins','2016-06-18 08:33:17','2016-06-18 08:33:17'),(7,'Tomcat','2016-06-18 08:33:25','2016-06-18 08:33:25'),(8,'JMeter','2016-06-18 08:41:18','2016-06-18 08:41:55'),(9,'SELinux','2016-07-01 10:06:54','2016-07-01 10:06:54'),(10,'.net','2016-07-01 14:47:52','2016-07-01 14:47:52'),(11,'排序算法','2016-07-04 03:57:24','2016-07-04 03:57:24'),(12,'C语言','2016-07-04 06:25:23','2016-07-04 06:25:23'),(13,'Sikuli','2016-07-04 09:09:37','2016-07-04 09:09:37'),(14,'Mac','2016-07-04 09:09:52','2016-07-04 09:09:52'),(15,'Jython','2016-07-05 03:13:23','2016-07-05 03:13:23');
/*!40000 ALTER TABLE `tag` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `user`
--

DROP TABLE IF EXISTS `user`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `user` (
  `name` varchar(45) COLLATE utf8_unicode_ci NOT NULL,
  `password` varchar(60) COLLATE utf8_unicode_ci NOT NULL COMMENT '				',
  `enabled` tinyint(4) NOT NULL DEFAULT '1',
  PRIMARY KEY (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user`
--

LOCK TABLES `user` WRITE;
/*!40000 ALTER TABLE `user` DISABLE KEYS */;
INSERT INTO `user` VALUES ('peng','$2a$10$ztYk1rqH0pggx5LPbay2QOJsDeFwkZhpvXCeejzZQu2mHwXCT.Ka2',1);
/*!40000 ALTER TABLE `user` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `user_roles`
--

DROP TABLE IF EXISTS `user_roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `user_roles` (
  `user_role_id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(45) COLLATE utf8_unicode_ci NOT NULL,
  `role` varchar(45) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`user_role_id`),
  UNIQUE KEY `uni_username_role` (`role`,`username`),
  KEY `fk_username_idx` (`username`),
  CONSTRAINT `fk_foreng_username` FOREIGN KEY (`username`) REFERENCES `user` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user_roles`
--

LOCK TABLES `user_roles` WRITE;
/*!40000 ALTER TABLE `user_roles` DISABLE KEYS */;
INSERT INTO `user_roles` VALUES (1,'peng','ROLE_ADMIN');
/*!40000 ALTER TABLE `user_roles` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2016-07-05  6:38:39
